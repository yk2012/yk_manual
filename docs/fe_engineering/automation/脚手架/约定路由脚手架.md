# å‰è¨€

> ä»Šå¤©æˆ‘ä»¬æ¥å¤ä¹ &æ€»ç»“é’è®­è¥å®æˆ˜ç­ç¬¬ä¸€å¤©çš„è¯¾ç¨‹ï¼Œä¹Ÿå°±æ˜¯**å…¨æ ˆç„¶å”**å¸¦æ¥çš„**NodeåŸºç¡€Apiä¸CLIå®æˆ˜**è¯¾ç¨‹ã€‚ 


ä»Šå¤©ä¸»è¦å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„è„šæ‰‹æ¶å·¥å…· ğŸ› ï¸ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å†™å°demoçš„æ—¶å€™è¦è¿›è¡Œå„ç§é‡å¤é…ç½® ğŸ•¹ï¸ã€‚æœ€åæˆ‘ä»¬å‘å¸ƒåˆ°npmä»“åº“ï¼Œè®©å‘¨å›´çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥ä½¿ç”¨ä½ å†™çš„å·¥å…·~ å…¶å®æˆ‘ä»¬ä»Šå¤©ä¸»è¦è¦å­¦ä¹ çš„æ˜¯ä¸€ç§**è‡ªåŠ¨åŒ–**çš„æ€æƒ³ï¼Œè¿™ä¹Ÿæ˜¯**å‰ç«¯å·¥ç¨‹åŒ–**é‡è¦çš„ä¸€ç¯ã€‚

æœ¬æ–‡ä» â‘  NodeåŸºç¡€ åˆ° â‘¡ è„šæ‰‹æ¶æ­å»º åˆ° â‘¢ npmä»“åº“ä¸Šä¼  ï¼Œå®Œå…¨ä»0åˆ°1é€ è½®å­ï¼Œæ²¡æœ‰åŸºç¡€çš„å°ä¼™ä¼´ä¹Ÿèƒ½çœ‹æ‡‚~
PSï¼šè¿™æ˜¯ç¬¬ä¸€ç¯‡ï¼Œåé¢è¿˜æœ‰ä¸€ç¯‡ æˆ‘ä»¬ç”¨happy-pathå°æ­¥èµ°çš„ç¼–ç æ–¹å¼å†å†™ä¸€ä¸ªkoaçš„è„šæ‰‹æ¶å·¥å…·ï¼Œä½ ä¼šæ”¶è·æ›´å¤š~~ **ç‚¹èµ ğŸ‘ è¶Šå¤šæ›´æ–°è¶Šå¿« âœˆï¸**

ç›¸å…³çš„ä»£ç åœ¨è¿™é‡Œhttps://gitee.com/ykang2020/youth_camp_ykjun

~~PS: æˆ‘åºŸè¯æ˜¯çœŸçš„å¤š.......~~





# ä¸€ã€NodeåŸºç¡€API

åœ¨å­—èŠ‚è·³åŠ¨é’è®­è¥åŸºç¡€ç­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€äº›Node.jsçš„åŸºç¡€æ¦‚å¿µï¼Œä»Šå¤©æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹Node.jsçš„ä¸€äº›åŸºç¡€APIï¼Œä¸ºæˆ‘ä»¬åé¢å®è·µéƒ¨åˆ†åšå¥½é“ºå« ğŸƒâ€â™‚ï¸ ğŸƒâ€  ~

PS: åŸºç¡€ç­çš„è¯¾ç¨‹ç¬”è®°åšæ–‡åœ¨è¿™é‡Œï¼š
- [ã€é’è®­è¥ã€‘Node.jsåŸºç¡€ - ç‰¹ç‚¹ - æ¨¡å—åŒ–CommonJS&ESM - npmåŒ…ç®¡ç†](https://juejin.cn/post/7005394037024768008)
- [ã€é’è®­è¥ã€‘Node.jsåŸºç¡€ - å¼‚æ­¥ç¼–ç¨‹å››ç§è§£å†³æ–¹æ¡ˆ](https://juejin.cn/post/7005509871000895524)
- [ã€é’è®­è¥ã€‘Node.jsåŸºç¡€ - Webåº”ç”¨å¼€å‘ - å¼€å‘è°ƒè¯• - çº¿ä¸Šéƒ¨ç½²](https://juejin.cn/post/7008545681778409502)

> node.jsAPI å®˜æ–¹æ–‡æ¡£ ä¸­æ–‡ï¼šhttp://nodejs.cn/api/ è‹±æ–‡ï¼šhttps://nodejs.org/dist/latest-v14.x/docs/api/
### æ ¸å¿ƒAPI - æ— éœ€ `require`
- buffer
- module
- process

### å†…ç½®API - éœ€è¦ `require` æ— éœ€ `install`
- os
- fs
- path
- http
- event



## 1. fsä¸å¼‚æ­¥IO
å‚è€ƒï¼šhttp://nodejs.cn/api/fs.html ä»¥åŠ https://nodejs.org/dist/latest-v14.x/docs/api/fs.html

é¦–å…ˆå¼•å…¥ `fs` æ–‡ä»¶æ¨¡å—

```js
const fs = require("fs");
```

### â‘  åŒæ­¥è¯»å–æ–‡ä»¶

```js
// åŒæ­¥è¯»å–
const data = fs.readFileSync("./04_buffer.js");
console.log("data", data.toString());
```
è¿™é‡Œå¦‚æœä¸è°ƒç”¨ `data` çš„ `toString()` æ–¹æ³•ï¼Œç»“æœåˆ™ä¼šè¿”å›ä¸€ä¸ª `buffer` ï¼Œå› ä¸ºå¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œå®ƒæ‰€å­˜å‚¨çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶

ä½¿ç”¨ `data` çš„ `toString()` æ–¹æ³•æ˜¯é»˜è®¤å°†äºŒè¿›åˆ¶æ–‡ä»¶æŒ‰ `utf-8` è½¬æ¢æˆæ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤è°ƒç”¨ `toString('utf-8')`

### â‘¡ å¼‚æ­¥è¯»å–æ–‡ä»¶

é”™è¯¯ä¼˜å…ˆçš„å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ–‡ä»¶å¤„ç†æ“ä½œ
```js
fs.readFile("./04_buffer.js", (err, data) => {
  if (err) throw err;
  console.log(data.toString());
})
```

æˆ‘ä»¬çŸ¥é“ä½¿ç”¨å›è°ƒå½¢å¼è¿›è¡Œå¼‚æ­¥æ“ä½œä¸å¥½ï¼Œæˆ‘ä»¬ç°åœ¨éƒ½æ˜¯ç”¨ `promise` äº†ï¼Œæ‰€ä»¥è‡ªç„¶çš„æƒ³åˆ°å¯ä»¥å°†å¼‚æ­¥æ–‡ä»¶è¯»å–æœ‰æ²¡æœ‰ `promise` é£æ ¼çš„APIå¯ä»¥ä½¿ç”¨ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ `async/await` æ¥ä½¿ç”¨å¼‚æ­¥æ–‡ä»¶æ“ä½œ

Node.jsæä¾›äº†Promiseé£æ ¼çš„fsæ–‡ä»¶æ“ä½œAPIï¼Œå¯ä»¥çœ‹æ–‡æ¡£

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1084a36d68dc402c81f625be18b7e3b4~tplv-k3u1fbpfcp-watermark.image?)


### â‘¢ promisify

åœ¨Node.jsçš„ `util` ä¸­æä¾›äº†ä¸€ä¸ªæ–¹æ³• `promisify` ï¼Œå¯ä»¥å°†å›è°ƒçš„æ–¹æ³•ä¿®é¥°æˆ `promise` é£æ ¼çš„APIï¼Œå°±å¯ä»¥ä½¿ç”¨ `async/await` è¯­æ³•äº†



```js
(async () => {
  const fs = require("fs");
  const { promisify } = require("util");
  const readFile = promisify(fs.readFile);
  
  const data = await readFile("./04_buffer.js");
  console.log(data.toString());
})();
```


## 2. bufferä¸å­—ç¬¦é›†

`buffer` ç¿»è¯‘è¿‡æ¥å°±æ˜¯**ç¼“å†²åŒº**

åˆ†é…ä¸€ä¸ª10ä¸ªå­—èŠ‚çš„ `buffer`
```js
const buf1 = Buffer.alloc(10)
console.log(buf1) // <Buffer 00 00 00 00 00 00 00 00 00 00>
```
æ‰“å°è¾“å‡ºçœ‹çœ‹ï¼Œæ–¹ä¾¿æ˜¾ç¤ºé˜…è¯»ï¼Œè½¬æ¢æˆäº†åå…­è¿›åˆ¶ï¼Œåº•å±‚å½“ç„¶æ˜¯äºŒè¿›åˆ¶å­˜å‚¨çš„

ä¸‹é¢ä½¿ç”¨ `buffer` å­˜å‚¨ä¸€ä¸ªè‹±æ–‡æ–‡å­—ï¼Œä¸€ä¸ªå­—æ¯ä¸€ä¸ªå­—èŠ‚
```js
const buf2 = Buffer.from('yk')
console.log(buf2) //<Buffer 79 6b>
```

ä½¿ç”¨ `buffer` å­˜å‚¨ä¸€ä¸ªä¸­æ–‡æ–‡å­—ï¼Œä¸€ä¸ªæ–‡å­—ä¸‰ä¸ªå­—èŠ‚ï¼ˆutf-8ï¼‰
```js
const buf3 = Buffer.from('èŒ')
console.log(buf3) // <Buffer e8 8f 8c>   utf-8/16/32
```

å¯ä»¥è¿æ¥ä¸¤ä¸ª `buffer`
```js
const buf4 = Buffer.concat([buf2, buf3])
console.log(buf4, buf4.toString()) // <Buffer 79 6b e8 8f 8c> ykèŒ
```
ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œä½¿ç”¨ `toString` æ–¹æ³•å°±å¯ä»¥æ˜¾ç¤ºæ–‡å­—



## 3. http

ä½¿ç”¨ `http` æ¨¡å—å¿«é€Ÿå†™ä¸€ä¸ª `http` æœåŠ¡å™¨
```js
const http = require("http");

http
  .createServer((request, response) => {
    console.log("a request");
    response.end("Hi YKèŒ");  // è¿™ä¸ªendä¸å¤ªå¥½ï¼Œä¸å¥½ç†è§£
  })
  .listen(3000, () => {
    console.log("Server at 3000");
  });
```


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3d9205a69864a49ac0627ac0a4275b9~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬æ¥çœ‹çœ‹åŸå‹é“¾ï¼Œå…ˆæ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥è·å–å¯¹è±¡çš„åŸå‹é“¾

```js
function getPrototypeChain(obj) {
  const protoChain = [];
  while ((obj = Object.getPrototypeOf(obj))) {
    protoChain.push(obj);
  }
  return protoChain;
}
```

æ¥çœ‹çœ‹ `request` å’Œ `response` çš„åŸå‹é“¾

```js
const http = require("http");

http
  .createServer((request, response) => {
    console.log(
      "a request",
      getPrototypeChain(request),
      getPrototypeChain(response)
    );
    response.end("Hi YK node");
  })
  .listen(3000, () => {
    console.log("Server at 3000");
  });
```

requestçš„åŸå‹é“¾

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6bb00aec5744296bbaae76e2ac0420c~tplv-k3u1fbpfcp-watermark.image?)

responseçš„åŸå‹é“¾

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7e0b6e1a78c412a8a81c8798488b571~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥å‘ç° `request` ä¸ `response` éƒ½æ˜¯ç»§æ‰¿è‡ª `Stream` çš„

è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åé¢å†è®¨è®ºï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬çš„ `http` æ¨¡å—æ¥æ­å»ºæœåŠ¡å™¨

æˆ‘ä»¬è¿”å›ä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œè¿™å°±ç”¨åˆ°æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„ `fs` æ–‡ä»¶è¯»å–APIäº†

```js
const fs = require("fs");
const http = require("http");

http
  .createServer((request, response) => {
    const { url, method } = request;
    console.log("url:", url);
    if (url === "/" && method === "GET") {
      fs.readFile("index.html", (err, data) => {
        if (err) {
          response.writeHead(500, {
            "Content-Type": "text/plain;charset=utf-8",
          });
          response.end("500 æœåŠ¡å™¨æŒ‚äº†ï¼Œå…„å¼Ÿï¼ï¼ï¼");
        }
        response.statusCode = 200;
        response.setHeader("Content-Typr", "text/html");
        response.end(data);
      });
    } else {
      response.statusCode = 400;
      response.setHeader("Content-Type", "text/plain;charset=utf-8");
      response.end("404 æ‰¾ä¸åˆ°äº†å‘€ï¼");
    }
  })
  .listen(3000, () => {
    console.log("Server at 3000");
  });
```

### ç»ƒä¹ 1 nodeåŸºç¡€ fs\buffer\http æ­å»ºä¸€ä¸ªhttpæœåŠ¡

å†™ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œè¿”å›index.html

![å¾®ä¿¡æˆªå›¾_20210920104152.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/908f1eb0050d4d30967468e09a829a66~tplv-k3u1fbpfcp-watermark.image?)

å¦‚æœæˆ‘ä»¬çš„index.htmlæ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªimgæ ‡ç­¾ï¼Œå¼•å…¥äº†ä¸€å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿç›´æ¥ç”¨ `readFile` è¯»å–å¯ä»¥å—ï¼Ÿå›¾ç‰‡ä¸€èˆ¬éƒ½æ¯”è¾ƒå¤§ï¼Œè¿™æ ·ä¼šå¤§é‡æ¶ˆè€—å†…å­˜èµ„æºï¼Œä¸è¦ç›´æ¥ä½¿ç”¨ `readFile` è¯»å–ï¼Œ å› ä¸ºå®ƒè¦æŠŠå…¨éƒ¨å›¾ç‰‡å†…å®¹åŠ è½½åˆ°æœåŠ¡å™¨ã€‚

é‚£åº”è¯¥ç”¨ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å¼•å…¥ä¸‹é¢ `Stream` æµçš„æ¦‚å¿µ

## 4. stream

åœ¨æœ¬åœ°å¤åˆ¶ä¸€ä¸ªå›¾ç‰‡

```js
const fs = require("fs");
// å›¾ç‰‡å¤åˆ¶  ä½¿ç”¨ fs read+writeä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯éœ€è¦è¯»åˆ°å†…å­˜å†ä»å†…å­˜ä¸­å†™å‡ºå»

// æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼
const rs = fs.createReadStream("./YKèŒ.jpg");
const ws = fs.createWriteStream("./YKèŒåˆ†èº«.jpg");

// ç®¡é“ï¼Œæ–‡ä»¶æµï¼Œä»ä¸€ä¸ªæ–‡ä»¶æµåˆ°å¦ä¸€ä¸ªæ–‡ä»¶
rs.pipe(ws);
```

æ–‡ä»¶æµï¼Œä»ä¸€ä¸ªæ–‡ä»¶æµåˆ°å¦ä¸€ä¸ªæ–‡ä»¶
 
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffb34ee8a5254b039536ff288362414d~tplv-k3u1fbpfcp-watermark.image?)

æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·ç¼–å†™ä»£ç 


```js
const fs = require("fs");
const http = require("http");

http
  .createServer((request, response) => {
    const { url, method } = request;
    console.log("url:", url);
    if (url === "/" && method === "GET") {
      fs.readFile("index.html", (err, data) => {
        if (err) {
          response.writeHead(500, {
            "Content-Type": "text/plain;charset=utf-8",
          });
          response.end("500 æœåŠ¡å™¨æŒ‚äº†ï¼Œå…„å¼Ÿï¼ï¼ï¼");
        }
        response.statusCode = 200;
        response.setHeader("Content-Typr", "text/html");
        response.end(data);
      });
    } else if (url === "/users" && method === "GET") {
      response.writeHead(200, { "Content-Type": "application/json" });
      response.end(JSON.stringify({ name: "ykèŒ" }));
    } else if (method === "GET" && headers.accept.indexOf("image/*" !== -1)) {
      // æ‹¿åˆ°æ‰€æœ‰å›¾ç‰‡
      // ä¸è¦ç›´æ¥ä½¿ç”¨readFileè¯»å–ï¼Œ å› ä¸ºå®ƒè¦æŠŠå…¨éƒ¨å›¾ç‰‡å†…å®¹åŠ è½½åˆ°æœåŠ¡å™¨
      // ä½¿ç”¨ æµ stream ï¼ï¼ï¼ï¼
      fs.createReadStream("." + url).pipe(response);
    } else {
      response.statusCode = 400;
      response.setHeader("Content-Type", "text/plain;charset=utf-8");
      response.end("404 æ‰¾ä¸åˆ°äº†å‘€ï¼");
    }
  })
  .listen(3000, () => {
    console.log("Server at 3000");
  });
```

åœ¨index.htmlæ·»åŠ å›¾ç‰‡ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿”å›å›¾ç‰‡çš„æ—¶å€™ä½¿ç”¨æµçš„å½¢å¼è¿”å›ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ed7b00cad874e4b9794db4b505d4302~tplv-k3u1fbpfcp-watermark.image?)


## 5. å­è¿›ç¨‹
> `child_process`æ¨¡å—ç»™äºˆNodeå¯ä»¥éšæ„åˆ›å»ºå­è¿›ç¨‹ï¼ˆchild_processï¼‰çš„èƒ½åŠ›ã€‚

å®ƒæä¾›äº†4ä¸ªæ–¹æ³•ç”¨äºåˆ›å»ºå­è¿›ç¨‹ã€‚

- `spawn()`ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ã€‚
- `exec()`ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸`spawn()`ä¸åŒçš„æ˜¯å…¶æ¥å£ä¸åŒï¼Œå®ƒæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°è·çŸ¥å­è¿›ç¨‹çš„çŠ¶å†µã€‚
- `execFile()`ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚
- `fork()`ï¼šä¸`spawn()`ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºå®ƒåˆ›å»ºNodeçš„å­è¿›ç¨‹åªéœ€æŒ‡å®šè¦æ‰§è¡Œçš„JavaScriptæ–‡ä»¶æ¨¡å—å³å¯ã€‚


# äºŒã€å®æˆ˜ï¼šå®ç° `cli` å·¥å…·

> ç›®æ ‡ï¼šåˆ©ç”¨æˆ‘ä»¬å­¦è¿‡çš„Node.jsçš„çŸ¥è¯†ï¼Œå®ç°ä¸€ä¸ªè‡ªå·±çš„è„šæ‰‹æ¶å·¥å…·ï¼Œè„šæ‰‹æ¶ç”¨æ¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªä¼šè‡ªåŠ¨ç”Ÿæˆå‰ç«¯è·¯ç”±çš„æ¨¡æ¿é¡¹ç›®ã€‚æˆ‘ä»¬å«å®ƒ**çº¦å®šè·¯ç”±**

## 1. åˆå§‹åŒ–

æ–°å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œå¹¶åˆå§‹åŒ–
```powershell
mkdir vue-auto-router-cli
cd vue-auto-router-cli
npm init -y
```

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹binï¼Œç„¶ååˆ›å»ºä¸€ä¸ªyk.jsæ–‡ä»¶ï¼Œä½œä¸ºå…¥å£æ–‡ä»¶


è¦è®©å…¨å±€å¯ä»¥ä½¿ç”¨ `yk` æŒ‡ä»¤ï¼Œåœ¨ package.json ä¸­åŠ å…¥è¿™ä¸ªé…ç½®é¡¹

```json
"bin": {
  "yk": "./bin/yk.js"
},
```

åœ¨ yk.js å¤´éƒ¨åŠ ä¸Šï¼Œç”¨æ¥æŒ‡å®šè§£é‡Šå™¨ç±»å‹ä¸ºnode
```js
#!/usr/bin/env node
console.log('æ¬¢è¿ä½¿ç”¨YKèŒçš„ cli å·¥å…·');
```

æœ€ååˆ«å¿˜äº† `link` ä¸€ä¸‹
```powershell
npm link
```

æ­¤æ—¶åœ¨ä»»æ„ç›®å½•ä¸‹çš„æ§åˆ¶å°ä¸­æ‰§è¡Œ `yk` æŒ‡ä»¤ åå°å°±éƒ½ä¼šç”¨ `node` æ‰§è¡Œyk.jsæ–‡ä»¶


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ae65e76f57b4d73a6a48e5f5c92ef1c~tplv-k3u1fbpfcp-watermark.image?)

## 2. å®šåˆ¶å‘½ä»¤è¡Œé¡µé¢

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®šåˆ¶ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„å‘½ä»¤è¡Œé¡µé¢


```js
#!/usr/bin/env node
console.log("æ¬¢è¿ä½¿ç”¨YKèŒçš„ cli å·¥å…·");
console.log(process.argv);
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b530d4c4e9349ad964069a8b530a902~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨`process.argv`ä¸­

æˆ‘ä»¬å…ˆå®‰è£…ä¸€ä¸‹æ¥ä¸‹æ¥è¦ç”¨åˆ°çš„æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹åº“

```powershell
npm i commander download-git-repo ora@5 handlebars figlet clear chalk open -s
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ `commander` æ¥å®šåˆ¶æˆ‘ä»¬çš„å‘½ä»¤è¡Œ

æˆ‘ä»¬çš„yk.jsè¿™æ ·ç¼–å†™

```js
#!/usr/bin/env node
// console.log("æ¬¢è¿ä½¿ç”¨YKèŒçš„ cli å·¥å…·");
// console.log(process.argv);
const program = require("commander");

program.version(require("../package.json").version);

program
  .command("init <name>")
  .description("init project")
  .action((name) => {
    console.log("init " + name);
  });
program.parse(process.argv);
```

ç°åœ¨å†ä½¿ç”¨æˆ‘ä»¬çš„ `yk` æŒ‡ä»¤ï¼Œå°±åƒç‚¹æ ·å­äº†~

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41232d2d349b4f4faf6ff0d50ab06105~tplv-k3u1fbpfcp-watermark.image?)

## 3. å®šåˆ¶åˆå§‹åŒ–é¡¹ç›®çš„æ¬¢è¿ç•Œé¢

æˆ‘ä»¬å°†program.actionä¸­ä¸å¯èƒ½åªæ‰“å°ä¸€å¥è¯ï¼Œæˆ‘ä»¬æŠŠåˆå§‹åŒ–é¡¹ç›®çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥

```js
program.action(require("../lib/init"))
```

æˆ‘ä»¬å°±åˆ›å»ºæ–‡ä»¶ lib/init.js

```js
// æ‰“å°æ¬¢è¿ç•Œé¢
const { promisify } = require("util");
const figlet = promisify(require("figlet"));
const clear = require("clear");
const chalk = require("chalk");
// å°è£…ä¸€ä¸ªè¾“å‡ºç»¿è‰²æ–‡å­—çš„API
const log = (content) => console.log(chalk.green(content));

module.exports = async (name) => {
  // æ‰“å°æ¬¢è¿ç•Œé¢
  clear();

  const data = await figlet.textSync("YK!Welcome");
  log(data);
}
```

æ­¤æ—¶ä½¿ç”¨ `yk` åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°æ¬¢è¿é¡µé¢äº†~

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a7a0009b49e4b42b7c9124dde828c39~tplv-k3u1fbpfcp-watermark.image?)


å½“ç„¶è¿™é‡Œçš„æ–‡å­—çš„æ ·å¼å¯ä»¥è‡ªå·±å®šåˆ¶ å¯ä»¥çœ‹çœ‹æ–‡æ¡£ https://www.npmjs.com/package/figlet

è¿™é‡Œæˆ‘å°±éšä¾¿é…ç½®ä¸€ä¸ªå­—ä½“æ ·å¼äº†~

```js
const data = await figlet.textSync("YK!Welcome",{
  font: "Ghost",
  horizontalLayout: "default",
  verticalLayout: "default",
  width: 200,
  whitespaceBreak: true,
});
```
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a16172adbd6b4f29b638603934b88628~tplv-k3u1fbpfcp-watermark.image?)



## 4. ä¸‹è½½ä»£ç æ¨¡æ¿

æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶ç”¨æ¥å¤„ç†ä¸‹è½½ä»£ç æ¨¡æ¿çš„é€»è¾‘


æ–°å»º lib/download.js
```js
const { promisify } = require("util");

module.exports.clone = async function (repo, desc) {
  const download = promisify(require("download-git-repo"));

  const ora = require("ora"); // è¿›åº¦æ¡
  const process = ora(`âœˆä¸‹è½½.......${repo}`);

  await process.start();
  await download(repo, desc);
  process.succeed();
};
```
è¿™é‡Œç”¨åˆ°ä¸¤ä¸ªåº“ `download-git-repo` åº“ç”¨æ¥ä¸‹è½½ä»£ç æ¨¡æ¿ å’Œ `ora` åº“ç”¨æ¥æ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡ï¼ˆè¿™é‡Œæˆ‘ä»¬å®‰è£…çš„æ˜¯5ç‰ˆæœ¬ï¼Œæœ€æ–°çš„æ˜¯6ç‰ˆæœ¬ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æœ€æ–°ç‰ˆå‘¢ï¼Œå› ä¸ºæœ€æ–°ç‰ˆåªæ”¯æŒESMæ¨¡å—åŒ–å¼•å…¥ï¼‰

åœ¨GitHubä¸Šé¢å‡†å¤‡ä¸€ä¸ªä»£ç æ¨¡æ¿

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23fe245f67cb4237a712dfd77cecc8d9~tplv-k3u1fbpfcp-watermark.image?)

åœ¨init.jsä¸­å¼•å…¥å¹¶ä½¿ç”¨ä¸‹è½½æ¨¡å—å³å¯

```js
const { clone } = require("./download");

module.exports = async (name) => {

  log("åˆ›å»ºé¡¹ç›®" + name);
  // è¿™é‡Œçš„gitä»“åº“å¯ä»¥è‡ªå·±æŒ‡å®š
  await clone("github:yk2012/vue-template", name);
};

```


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1c3c65b4adb4d119866cc352b5dcd2e~tplv-k3u1fbpfcp-watermark.image?)


å¯ä»¥çœ‹åˆ°æ–‡ä»¶å°±å·²ç»è¢«ä¸‹è½½åˆ°å½“å‰ç›®å½•ä¸‹äº†

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d298617993643fba0c5542e323b4298~tplv-k3u1fbpfcp-watermark.image?)




## 5. è‡ªåŠ¨å®‰è£…é¡¹ç›®ä¾èµ–

åœ¨Node.jsä¸­ä½¿ç”¨å­è¿›ç¨‹ `child_process` å®‰è£…ä¾èµ–

åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å®‰è£…çš„ `promise` é£æ ¼çš„æ¥å£ï¼Œç„¶åè¿˜è¦åˆå¹¶å­è¿›ç¨‹çš„æµåˆ°ä¸»è¿›ç¨‹ä¸­
```js
const spawn = async (...args) => {
  // åŒæ­¥Promise api
  const { spawn } = require("child_process");
  return new Promise((resolve) => {
    
    // windowsç³»ç»Ÿå…¼å®¹æ€§å¤„ç†
    const options = args[args.length - 1];
    if (process.platform === "win32") {
      options.shell = true;
    }

    const proc = spawn(...args);
    // è¾“å‡ºæµ å­è¿›ç¨‹ åˆå¹¶åˆ° ä¸»è¿›ç¨‹
    proc.stdout.pipe(process.stdout);
    proc.stderr.pipe(process.stderr);
    proc.on("close", () => {
      resolve();
    });
  });
};
```
æ³¨æ„ä¸­é—´æœ‰ä¸€æ®µå¤„ç†Windowså…¼å®¹æ€§é—®é¢˜çš„ä»£ç ã€‚


è°ƒç”¨å­è¿›ç¨‹å®‰è£…ä¾èµ– ï¼ˆå°±æ˜¯åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ`npm install`ï¼‰

```js
// ä¸‹è½½ä¾èµ– npm i
// å­è¿›ç¨‹
// spawn("npm", ["install"]);
log(`å®‰è£…ä¾èµ–....`);
await spawn("npm", ["install"], { cwd: `./${name}` });
```


## 6. é…ç½®è‡ªåŠ¨æ‰“å¼€æœåŠ¡


```js
  log(
    chalk.green(
      `
    å®‰è£…å®Œæˆï¼š
    To get Starat :
    ================================
      cd ${name}
      npm run serve
    ================================
    `
    )
  );
  open("http://localhost:8080/");
  await spawn("npm", ["run", "serve"], { cwd: `./${name}` });
```

å®Œæ•´çš„æ¼”ç¤º

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac7daf85b28445939645144eb942cecf~tplv-k3u1fbpfcp-watermark.image?)

è‡ªåŠ¨è·³è½¬é“¾æ¥ï¼Œæ‰“å¼€å‰ç«¯é¡¹ç›®é¡µé¢

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6322a8e863874ed297214c77b53034d5~tplv-k3u1fbpfcp-watermark.image?)




## 7. å®ç°çº¦å®šè·¯ç”±

æ ¹æ®viewsç›®å½•ä¸­çš„é¡µé¢ï¼Œè‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨viewsç›®å½•ä¸‹é¢æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œç„¶åæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå°±ä¼šè‡ªåŠ¨é…ç½®è·¯ç”±åœ¨é¡µé¢ï¼Œè¿™ä¹Ÿæ˜¯å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åŠŸèƒ½äº†~ ä¸ç”¨æ‰‹åŠ¨é…ç½®ï¼Œç¨‹åºè‡ªåŠ¨é…ç½®è¿™ä¸æ˜¯å¾ˆé¦™å˜›~~

åœ¨libæ–‡ä»¶å¤¹ä¸­åˆ›å»ºrefresh.jsæ–‡ä»¶ï¼Œè¿™é‡Œç¼–å†™æˆ‘ä»¬çš„ä»£ç é€»è¾‘

```js
// è¯»æ–‡ä»¶åˆ—è¡¨

// æ‹¼ä»£ç ã€‚æ¨¡æ¿æ¸²æŸ“çš„æ–¹å¼

const fs = require("fs");
const handlebars = require("handlebars");
const chalk = require("chalk");

module.exports = async () => {
  // è·å–åˆ—è¡¨
  const list = fs
    .readdirSync("./src/views")
    .filter((v) => v !== "Home.vue")
    .map((v) => ({
      name: v.replace(".vue", "").toLowerCase(),
      file: v,
    }));

  // ç”Ÿæˆè·¯ç”±å®šä¹‰
  compile({ list }, "./src/router.js", "./template/router.js.hbs");
  // ç”Ÿæˆèœå•
  compile({ list }, "./src/App.vue", "./template/App.vue.hbs");

  /**
   *
   * @param {*} meta æ•°æ®å®šä¹‰
   * @param {*} filePath  ç›®æ ‡æ–‡ä»¶
   * @param {*} templatePath æ¨¡æ¿
   */
  function compile(meta, filePath, templatePath) {
    if (fs.existsSync(templatePath)) {
      const content = fs.readFileSync(templatePath).toString();
      const result = handlebars.compile(content)(meta);
      fs.writeFileSync(filePath, result);
      console.log(chalk.green(`${filePath}åˆ›å»ºæˆåŠŸ`));
    }
  }
};
```
åœ¨yk.jsæ–‡ä»¶ä¸­åŠ å…¥è¿™ä¸ªæŒ‡ä»¤

```js
program
  .command("refresh")
  .description("refresh routers...")
  .action(require("../lib/refresh"));
```




æˆ‘ä»¬æ–°å»ºåœ¨viewsæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºä¸€ä¸ªç»„ä»¶Yk.vue

ç„¶åæ‰§è¡Œ `yk refresh`

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/595ea3d9b01342e7bcd73fa2a0f603c9~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°æ•ˆæœ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91f1f8dc75754484a802bf42f5675913~tplv-k3u1fbpfcp-watermark.image?)


# ä¸‰ã€å‘å¸ƒåˆ°npmä¸­å¤®ä»“åº“

è¯¦ç»†æ“ä½œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡ [ã€npmã€‘å‘å¸ƒ è‡ªå®šä¹‰JSå·¥å…·å‡½æ•°åº“ åˆ°npmä¸­å¤®ä»“åº“](https://juejin.cn/post/7015133078645375007)

ä¸Šæ¬¡æˆ‘ä»¬æ˜¯ä¸€è¡Œä¸€è¡Œçš„æ•²çš„ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¹Ÿé‡‡ç”¨è‡ªåŠ¨åŒ–çš„æ–¹å¼ï¼Œå†™ä¸€ä¸ª.shæ–‡ä»¶

publish.sh


```sh
#!/usr/bin/env bash
npm config get registry # æ£€æŸ¥ä»“åº“é•œåƒåº“
npm config set registry=https://registry.npmjs.org
echo 'è¯·è¿›è¡Œç™»å½•ç›¸å…³æ“ä½œï¼š'
npm login # ç™»é™†
echo "-------publishing-------"
npm publish # å‘å¸ƒ
npm config set registry=https://registry.npm.taobao.org # è®¾ç½®ä¸ºæ·˜å®é•œåƒ
echo "å‘å¸ƒå®Œæˆ"
exit
```

æˆ‘æ¥ä¿®æ”¹ä¸‹æˆ‘è¿™ä¸ªåŒ…åä¸º vue-auto-router-cli-yk ç‰ˆæœ¬ä¸º 1.0.0
```js
{
  "name": "vue-auto-router-cli-yk",
  "version": "1.0.0",
  "description": "è¿™æ˜¯YKèŒå†™çš„vueè„šæ‰‹æ¶å·¥å…·",
  "main": "index.js",
  "bin": {
    "yk": "./bin/yk.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "chalk": "^4.1.2",
    "clear": "^0.1.0",
    "commander": "^8.2.0",
    "download-git-repo": "^3.0.2",
    "figlet": "^1.5.2",
    "handlebars": "^4.7.7",
    "open": "^8.2.1",
    "ora": "^5.4.1"
  }
}

```
æœ€åæˆ‘ä»¬æ‰§è¡Œshè„šæœ¬æ–‡ä»¶

Windowsçš„ç”µè„‘è¿˜ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘è£…äº†gitï¼Œgit bashå¯ä»¥æ‰“å¼€ï¼Œç„¶åè¿›å»æ–‡ä»¶å¤¹å‘ç°å¯ä»¥ç›´æ¥åŒå‡»æ‰“å¼€ï¼Œå“ˆå“ˆï¼Œé‚£æˆ‘å°±åŒå‡»æ‰“å¼€äº†~

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab4db40b50314accbcce28aa844a9650~tplv-k3u1fbpfcp-watermark.image?)


å¦‚æœä½ çœ‹è¿‡æˆ‘ä¹‹å‰çš„åšæ–‡[ã€npmã€‘å‘å¸ƒ è‡ªå®šä¹‰JSå·¥å…·å‡½æ•°åº“ åˆ°npmä¸­å¤®ä»“åº“](https://juejin.cn/post/7015133078645375007)ï¼Œé‚£å…¶å®ä½ ä¹Ÿä¸ç”¨é‚£ä¹ˆéº»çƒ¦ï¼Œç›´æ¥å‘½ä»¤è¡Œæ¢ä¸ªé•œåƒç„¶å`npm publish` å°±è¡Œäº†


ä¹Ÿå°±æ˜¯è¿™ä¸‰æ­¥
```powershell
npm config set registry=https://registry.npmjs.org
npm publish
npm config set registry=https://registry.npm.taobao.org
```


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16ab5960a54a40bdb769986d72a88677~tplv-k3u1fbpfcp-watermark.image?)


æœ€åå»npmå®˜ç½‘çœ‹çœ‹ https://www.npmjs.com/

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc34c8aa04e649a68d84bf692ec612be~tplv-k3u1fbpfcp-watermark.image?)

è¿™æ—¶å€™å°±å¯ä»¥è®©å‘¨å›´çš„å°ä¼™ä¼´ä½¿ç”¨ä½ åˆšåˆšç¼–å†™çš„è„šæ‰‹æ¶å·¥å…·å•¦~
```powershell
npm install vue-auto-router-cli-yk -g
yk init vue_demo
```
# å››ã€æ€»ç»“

ä»Šå¤©æˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†ä¸€ä¸‹Node.jsçš„åŸºç¡€APIï¼Œç„¶åæˆ‘ä»¬å†™äº†ä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶ï¼Œå¹¶å‘å¸ƒåˆ°äº†npmä»“åº“ã€‚ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªkoaæ¡†æ¶çš„è„šæ‰‹æ¶ï¼Œæ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œè€Œä¸”æˆ‘ä»¬ä¼šä½¿ç”¨happy-pathå°æ­¥èµ°çš„æ€è·¯æ¥ç¼–å†™ä»£ç ã€‚æœ‰äº†ä»Šå¤© `æµ` ä¸ `å­è¿›ç¨‹` çš„åŸºç¡€ï¼Œä¸‹ä¸€ç¯‡çš„å†…å®¹ä¹Ÿä¼šå¾ˆå¥½ç†è§£~

> æœ€åï¼Œå¯ä»¥ç•™ä¸ªè¨€ç‚¹ä¸ªèµå—ï¼Ÿ ç‚¹ä¸ªå…³æ³¨é‚£å°±å†å¥½ä¸è¿‡äº†ï¼Œä¸‹é¢è¿˜æœ‰ä¸“æ é“¾æ¥ï¼Œå¯ä»¥å…³æ³¨ä¸€æ³¢ï¼ŒåŠæ—¶æ”¶åˆ°**é’è®­è¥ç¬”è®°**ç³»åˆ—çš„æœ€æ–°åšæ–‡æ¶ˆæ¯ã€‚
