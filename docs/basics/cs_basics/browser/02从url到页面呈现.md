# 在浏览器里，从输入 URL 到页面展示，这中间发生了什么？

详细探索一下这道经典的面试题，主要考察以下两个方面的知识点：

## 总览

1. 网络知识（HTTP、TCP、CDN）
2. 浏览器知识（缓存、渲染原理）

- `浏览器进程`主要负责用户交互、子进程管理和文件储存等功能。
- `网络进程`是面向渲染进程和浏览器进程等提供网络下载功能。
- `渲染进程`的主要职责是把从网络下载的 HTML、JavaScript、CSS、图片等资源解析为可以显示和交互的页面。因为渲染进程所有的内容都是通过网络获取的，会存在一些恶意代码利用浏览器漏洞对系统进行攻击，所以运行在渲染进程里面的代码是不被信任的。这也是为什么 Chrome 会让渲染进程运行在安全沙箱里，就是为了保证系统的安全。


从URL到页面显示大体流程如下：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c29dfda4854c46c78f107c2431d3e0f7~tplv-k3u1fbpfcp-watermark.image?)

1. `浏览器进程`接收到用户输入的URL请求，将该URL请求转发给`网络进程`
2. 在`网络进程`中发起URL相应的请求
3. `网络进程`接收到了响应头数据，便解析响应头数据，并将数据转发给`浏览器进程`
4. `浏览器进程`接收到网络进程的响应头数据之后，发送“提交导航(CommitNavigation)”消息到`渲染进程`
5. `渲染进程`接收到“提交导航”的消息之后，便开始准备接收 HTML 数据，接收数据的方式是直接和`网络进程`建立数据管道
6. `渲染进程`会向浏览器进程“确认提交”，这是告诉`浏览器进程`：“已经准备好接受和解析页面数据了”
7. `浏览器进程`接收到渲染进程“提交文档”的消息之后，便开始移除之前旧的文档，然后更新浏览器进程中的页面状态


## 用户输入

当用户在地址栏中输入一个查询关键字时，地址栏会判断输入的关键字是搜索内容，还是请求的 URL。

- 如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的URL。
- 如果判断输入内容符合URL规则，那么地址栏会根据规则，把这段内容加上协议，合成为完整的URL

当用户输入关键字并键入回车之后，这意味着当前页面即将要被替换成新的页面，不过在这个流程继续之前，浏览器还给了当前页面一次执行 beforeunload 事件的机会，beforeunload 事件允许页面在退出之前执行一些数据清理操作，还可以询问用户是否要离开当前页面，比如当前页面可能有未提交完成的表单等情况，因此用户可以通过 beforeunload 事件来取消导航，让浏览器不再执行任何后续工作。



