<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>YK菌</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?f32c3b70c575fd4087e737d05053988a";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
<link rel="icon" href="/yk_manual/logo52.png">
<link rel="manifest" href="/yk_manual/manifest.json">
<link rel="apple-touch-icon" href="/yk_manual/icons/apple-touch-icon-152x152.png">
<link rel="mask-icon" href="/yk_manual/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/yk_manual/assets/css/0.styles.ac71bee4.css" as="style"><link rel="preload" href="/yk_manual/assets/js/app.1e74c93b.js" as="script"><link rel="preload" href="/yk_manual/assets/js/3.7830d0fe.js" as="script"><link rel="preload" href="/yk_manual/assets/js/1.caa73dc8.js" as="script"><link rel="preload" href="/yk_manual/assets/js/183.05a1f13a.js" as="script"><link rel="preload" href="/yk_manual/assets/js/9.94359d55.js" as="script"><link rel="prefetch" href="/yk_manual/assets/js/10.d7f11787.js"><link rel="prefetch" href="/yk_manual/assets/js/100.13f14c61.js"><link rel="prefetch" href="/yk_manual/assets/js/101.61c62ab5.js"><link rel="prefetch" href="/yk_manual/assets/js/102.53424960.js"><link rel="prefetch" href="/yk_manual/assets/js/103.c5bcdcdf.js"><link rel="prefetch" href="/yk_manual/assets/js/104.cb22d149.js"><link rel="prefetch" href="/yk_manual/assets/js/105.a5310998.js"><link rel="prefetch" href="/yk_manual/assets/js/106.610d8af8.js"><link rel="prefetch" href="/yk_manual/assets/js/107.4041c698.js"><link rel="prefetch" href="/yk_manual/assets/js/108.fbd10be0.js"><link rel="prefetch" href="/yk_manual/assets/js/109.fb5c49e4.js"><link rel="prefetch" href="/yk_manual/assets/js/11.8d113b5a.js"><link rel="prefetch" href="/yk_manual/assets/js/110.89d1c180.js"><link rel="prefetch" href="/yk_manual/assets/js/111.262e9777.js"><link rel="prefetch" href="/yk_manual/assets/js/112.f089f7e0.js"><link rel="prefetch" href="/yk_manual/assets/js/113.6b8025bc.js"><link rel="prefetch" href="/yk_manual/assets/js/114.769a79df.js"><link rel="prefetch" href="/yk_manual/assets/js/115.25e08cbf.js"><link rel="prefetch" href="/yk_manual/assets/js/116.f3d41cd1.js"><link rel="prefetch" href="/yk_manual/assets/js/117.908e745b.js"><link rel="prefetch" href="/yk_manual/assets/js/118.1e3292ce.js"><link rel="prefetch" href="/yk_manual/assets/js/119.c042df0b.js"><link rel="prefetch" href="/yk_manual/assets/js/12.26361350.js"><link rel="prefetch" href="/yk_manual/assets/js/120.8a37d9f0.js"><link rel="prefetch" href="/yk_manual/assets/js/121.ddbed957.js"><link rel="prefetch" href="/yk_manual/assets/js/122.47441221.js"><link rel="prefetch" href="/yk_manual/assets/js/123.91754538.js"><link rel="prefetch" href="/yk_manual/assets/js/124.28cf3045.js"><link rel="prefetch" href="/yk_manual/assets/js/125.bb3ba31a.js"><link rel="prefetch" href="/yk_manual/assets/js/126.c415a703.js"><link rel="prefetch" href="/yk_manual/assets/js/127.da64e53f.js"><link rel="prefetch" href="/yk_manual/assets/js/128.2b2e9527.js"><link rel="prefetch" href="/yk_manual/assets/js/129.fe841012.js"><link rel="prefetch" href="/yk_manual/assets/js/13.be0a436c.js"><link rel="prefetch" href="/yk_manual/assets/js/130.c542b5b1.js"><link rel="prefetch" href="/yk_manual/assets/js/131.e7ec40ca.js"><link rel="prefetch" href="/yk_manual/assets/js/132.9b5eb6ec.js"><link rel="prefetch" href="/yk_manual/assets/js/133.c329cf61.js"><link rel="prefetch" href="/yk_manual/assets/js/134.7480e9ee.js"><link rel="prefetch" href="/yk_manual/assets/js/135.50a63fa2.js"><link rel="prefetch" href="/yk_manual/assets/js/136.5f71be49.js"><link rel="prefetch" href="/yk_manual/assets/js/137.db6bc899.js"><link rel="prefetch" href="/yk_manual/assets/js/138.9eabadc5.js"><link rel="prefetch" href="/yk_manual/assets/js/139.c7ac68e8.js"><link rel="prefetch" href="/yk_manual/assets/js/14.acca63ee.js"><link rel="prefetch" href="/yk_manual/assets/js/140.5652b510.js"><link rel="prefetch" href="/yk_manual/assets/js/141.fa32d9e2.js"><link rel="prefetch" href="/yk_manual/assets/js/142.42cd7d52.js"><link rel="prefetch" href="/yk_manual/assets/js/143.82929412.js"><link rel="prefetch" href="/yk_manual/assets/js/144.ce2d4633.js"><link rel="prefetch" href="/yk_manual/assets/js/145.67328e9d.js"><link rel="prefetch" href="/yk_manual/assets/js/146.dc230736.js"><link rel="prefetch" href="/yk_manual/assets/js/147.5a2429c3.js"><link rel="prefetch" href="/yk_manual/assets/js/148.3ffa225c.js"><link rel="prefetch" href="/yk_manual/assets/js/149.1d8756cc.js"><link rel="prefetch" href="/yk_manual/assets/js/15.7f05ded0.js"><link rel="prefetch" href="/yk_manual/assets/js/150.541fece5.js"><link rel="prefetch" href="/yk_manual/assets/js/151.f74c144c.js"><link rel="prefetch" href="/yk_manual/assets/js/152.7b838815.js"><link rel="prefetch" href="/yk_manual/assets/js/153.9640084a.js"><link rel="prefetch" href="/yk_manual/assets/js/154.92a310f5.js"><link rel="prefetch" href="/yk_manual/assets/js/155.9246949c.js"><link rel="prefetch" href="/yk_manual/assets/js/156.80df7353.js"><link rel="prefetch" href="/yk_manual/assets/js/157.9e6d3ace.js"><link rel="prefetch" href="/yk_manual/assets/js/158.f33b55cd.js"><link rel="prefetch" href="/yk_manual/assets/js/159.5da36d43.js"><link rel="prefetch" href="/yk_manual/assets/js/16.f0cdef46.js"><link rel="prefetch" href="/yk_manual/assets/js/160.42591c34.js"><link rel="prefetch" href="/yk_manual/assets/js/161.405bf49a.js"><link rel="prefetch" href="/yk_manual/assets/js/162.0f5c9e17.js"><link rel="prefetch" href="/yk_manual/assets/js/163.636cc0bb.js"><link rel="prefetch" href="/yk_manual/assets/js/164.9057d3ca.js"><link rel="prefetch" href="/yk_manual/assets/js/165.e66564ea.js"><link rel="prefetch" href="/yk_manual/assets/js/166.6c96f2b5.js"><link rel="prefetch" href="/yk_manual/assets/js/167.ad34e66f.js"><link rel="prefetch" href="/yk_manual/assets/js/168.5f529977.js"><link rel="prefetch" href="/yk_manual/assets/js/169.c5cf2e9f.js"><link rel="prefetch" href="/yk_manual/assets/js/17.62a34f80.js"><link rel="prefetch" href="/yk_manual/assets/js/170.fe0f2359.js"><link rel="prefetch" href="/yk_manual/assets/js/171.a4eaa948.js"><link rel="prefetch" href="/yk_manual/assets/js/172.3bb950aa.js"><link rel="prefetch" href="/yk_manual/assets/js/173.ff4db752.js"><link rel="prefetch" href="/yk_manual/assets/js/174.5d1c5b57.js"><link rel="prefetch" href="/yk_manual/assets/js/175.2ac66192.js"><link rel="prefetch" href="/yk_manual/assets/js/176.0422a154.js"><link rel="prefetch" href="/yk_manual/assets/js/177.533ddb43.js"><link rel="prefetch" href="/yk_manual/assets/js/178.27c780ae.js"><link rel="prefetch" href="/yk_manual/assets/js/179.14bcdfd7.js"><link rel="prefetch" href="/yk_manual/assets/js/18.53949325.js"><link rel="prefetch" href="/yk_manual/assets/js/180.3bb761f0.js"><link rel="prefetch" href="/yk_manual/assets/js/181.3e39d4f9.js"><link rel="prefetch" href="/yk_manual/assets/js/182.256015a1.js"><link rel="prefetch" href="/yk_manual/assets/js/184.35abbdec.js"><link rel="prefetch" href="/yk_manual/assets/js/185.3f9b0b41.js"><link rel="prefetch" href="/yk_manual/assets/js/186.2002ad95.js"><link rel="prefetch" href="/yk_manual/assets/js/187.6e098027.js"><link rel="prefetch" href="/yk_manual/assets/js/188.8240e812.js"><link rel="prefetch" href="/yk_manual/assets/js/189.11917ed1.js"><link rel="prefetch" href="/yk_manual/assets/js/19.7ffdc525.js"><link rel="prefetch" href="/yk_manual/assets/js/190.8384944c.js"><link rel="prefetch" href="/yk_manual/assets/js/191.b1b8b274.js"><link rel="prefetch" href="/yk_manual/assets/js/192.4df7fb84.js"><link rel="prefetch" href="/yk_manual/assets/js/193.38533a27.js"><link rel="prefetch" href="/yk_manual/assets/js/194.fc9f9fb6.js"><link rel="prefetch" href="/yk_manual/assets/js/195.aa438065.js"><link rel="prefetch" href="/yk_manual/assets/js/196.6e8f17d2.js"><link rel="prefetch" href="/yk_manual/assets/js/197.4969693f.js"><link rel="prefetch" href="/yk_manual/assets/js/198.a86decf5.js"><link rel="prefetch" href="/yk_manual/assets/js/199.c2a026a4.js"><link rel="prefetch" href="/yk_manual/assets/js/20.04ee8563.js"><link rel="prefetch" href="/yk_manual/assets/js/200.9a5a59a9.js"><link rel="prefetch" href="/yk_manual/assets/js/201.6bf4b17f.js"><link rel="prefetch" href="/yk_manual/assets/js/202.13ebb870.js"><link rel="prefetch" href="/yk_manual/assets/js/203.de1b6112.js"><link rel="prefetch" href="/yk_manual/assets/js/204.fefb9db2.js"><link rel="prefetch" href="/yk_manual/assets/js/205.c8447473.js"><link rel="prefetch" href="/yk_manual/assets/js/206.a460a4ff.js"><link rel="prefetch" href="/yk_manual/assets/js/207.2acb1e5d.js"><link rel="prefetch" href="/yk_manual/assets/js/208.35b09e20.js"><link rel="prefetch" href="/yk_manual/assets/js/209.d38d7b8b.js"><link rel="prefetch" href="/yk_manual/assets/js/21.74669ef1.js"><link rel="prefetch" href="/yk_manual/assets/js/210.e45d2474.js"><link rel="prefetch" href="/yk_manual/assets/js/211.31fe7c76.js"><link rel="prefetch" href="/yk_manual/assets/js/212.1a87fd18.js"><link rel="prefetch" href="/yk_manual/assets/js/213.89b9a296.js"><link rel="prefetch" href="/yk_manual/assets/js/214.dea6baf1.js"><link rel="prefetch" href="/yk_manual/assets/js/215.d47b6025.js"><link rel="prefetch" href="/yk_manual/assets/js/216.b313d752.js"><link rel="prefetch" href="/yk_manual/assets/js/217.efa9283a.js"><link rel="prefetch" href="/yk_manual/assets/js/218.b2b8b8f1.js"><link rel="prefetch" href="/yk_manual/assets/js/219.0bf25be1.js"><link rel="prefetch" href="/yk_manual/assets/js/22.079f8482.js"><link rel="prefetch" href="/yk_manual/assets/js/220.9bce5bc3.js"><link rel="prefetch" href="/yk_manual/assets/js/221.e9e45caf.js"><link rel="prefetch" href="/yk_manual/assets/js/222.f7bef91e.js"><link rel="prefetch" href="/yk_manual/assets/js/223.b8e3047b.js"><link rel="prefetch" href="/yk_manual/assets/js/224.cbd138f1.js"><link rel="prefetch" href="/yk_manual/assets/js/225.8ef57c10.js"><link rel="prefetch" href="/yk_manual/assets/js/226.b59139e4.js"><link rel="prefetch" href="/yk_manual/assets/js/227.de181615.js"><link rel="prefetch" href="/yk_manual/assets/js/228.b8e2fa6e.js"><link rel="prefetch" href="/yk_manual/assets/js/229.87afea54.js"><link rel="prefetch" href="/yk_manual/assets/js/23.7fbb131d.js"><link rel="prefetch" href="/yk_manual/assets/js/230.bfc7254c.js"><link rel="prefetch" href="/yk_manual/assets/js/231.c93f0a54.js"><link rel="prefetch" href="/yk_manual/assets/js/232.8f74cc84.js"><link rel="prefetch" href="/yk_manual/assets/js/233.de8dc419.js"><link rel="prefetch" href="/yk_manual/assets/js/234.4fe8c045.js"><link rel="prefetch" href="/yk_manual/assets/js/235.96407c90.js"><link rel="prefetch" href="/yk_manual/assets/js/236.bfdf9a28.js"><link rel="prefetch" href="/yk_manual/assets/js/237.9c3ad4c8.js"><link rel="prefetch" href="/yk_manual/assets/js/238.ef5f34b3.js"><link rel="prefetch" href="/yk_manual/assets/js/239.705fc1c2.js"><link rel="prefetch" href="/yk_manual/assets/js/24.b4ce6d5d.js"><link rel="prefetch" href="/yk_manual/assets/js/240.ffe4c007.js"><link rel="prefetch" href="/yk_manual/assets/js/241.6fabd329.js"><link rel="prefetch" href="/yk_manual/assets/js/242.a661af8a.js"><link rel="prefetch" href="/yk_manual/assets/js/243.7ab1456f.js"><link rel="prefetch" href="/yk_manual/assets/js/244.20bb359a.js"><link rel="prefetch" href="/yk_manual/assets/js/245.3de39fb7.js"><link rel="prefetch" href="/yk_manual/assets/js/246.ba860037.js"><link rel="prefetch" href="/yk_manual/assets/js/247.7b2bd330.js"><link rel="prefetch" href="/yk_manual/assets/js/248.803aada4.js"><link rel="prefetch" href="/yk_manual/assets/js/249.bab59e87.js"><link rel="prefetch" href="/yk_manual/assets/js/25.b21145d4.js"><link rel="prefetch" href="/yk_manual/assets/js/250.9c137daf.js"><link rel="prefetch" href="/yk_manual/assets/js/251.4604b058.js"><link rel="prefetch" href="/yk_manual/assets/js/252.80466c1f.js"><link rel="prefetch" href="/yk_manual/assets/js/253.d8bc836a.js"><link rel="prefetch" href="/yk_manual/assets/js/254.1966098d.js"><link rel="prefetch" href="/yk_manual/assets/js/255.1d46c2b7.js"><link rel="prefetch" href="/yk_manual/assets/js/256.c85398e6.js"><link rel="prefetch" href="/yk_manual/assets/js/257.3f9ef502.js"><link rel="prefetch" href="/yk_manual/assets/js/258.d2b6d9b5.js"><link rel="prefetch" href="/yk_manual/assets/js/259.19e15ad7.js"><link rel="prefetch" href="/yk_manual/assets/js/26.de26e94a.js"><link rel="prefetch" href="/yk_manual/assets/js/260.47f48cb7.js"><link rel="prefetch" href="/yk_manual/assets/js/261.cb6c9914.js"><link rel="prefetch" href="/yk_manual/assets/js/262.1e82e307.js"><link rel="prefetch" href="/yk_manual/assets/js/263.31423df3.js"><link rel="prefetch" href="/yk_manual/assets/js/264.8faf6871.js"><link rel="prefetch" href="/yk_manual/assets/js/27.e0556273.js"><link rel="prefetch" href="/yk_manual/assets/js/28.8217e818.js"><link rel="prefetch" href="/yk_manual/assets/js/29.a7a9f6ed.js"><link rel="prefetch" href="/yk_manual/assets/js/30.ac3dd1f8.js"><link rel="prefetch" href="/yk_manual/assets/js/31.4de37d9e.js"><link rel="prefetch" href="/yk_manual/assets/js/32.44a80f37.js"><link rel="prefetch" href="/yk_manual/assets/js/33.6f61fa05.js"><link rel="prefetch" href="/yk_manual/assets/js/34.636c8ed2.js"><link rel="prefetch" href="/yk_manual/assets/js/35.dc841fa3.js"><link rel="prefetch" href="/yk_manual/assets/js/36.d23c3e4c.js"><link rel="prefetch" href="/yk_manual/assets/js/37.73ef5b7c.js"><link rel="prefetch" href="/yk_manual/assets/js/38.28953b54.js"><link rel="prefetch" href="/yk_manual/assets/js/39.223d3138.js"><link rel="prefetch" href="/yk_manual/assets/js/4.c8fb5d72.js"><link rel="prefetch" href="/yk_manual/assets/js/40.fbfec044.js"><link rel="prefetch" href="/yk_manual/assets/js/41.800917b8.js"><link rel="prefetch" href="/yk_manual/assets/js/42.90fcf4eb.js"><link rel="prefetch" href="/yk_manual/assets/js/43.93840981.js"><link rel="prefetch" href="/yk_manual/assets/js/44.8e504f4c.js"><link rel="prefetch" href="/yk_manual/assets/js/45.30e3ecf7.js"><link rel="prefetch" href="/yk_manual/assets/js/46.cc1c3c1c.js"><link rel="prefetch" href="/yk_manual/assets/js/47.7d4b6835.js"><link rel="prefetch" href="/yk_manual/assets/js/48.e7cf8c2f.js"><link rel="prefetch" href="/yk_manual/assets/js/49.9a203147.js"><link rel="prefetch" href="/yk_manual/assets/js/5.38e49e2b.js"><link rel="prefetch" href="/yk_manual/assets/js/50.715f4205.js"><link rel="prefetch" href="/yk_manual/assets/js/51.68432342.js"><link rel="prefetch" href="/yk_manual/assets/js/52.383740bb.js"><link rel="prefetch" href="/yk_manual/assets/js/53.d20fc45b.js"><link rel="prefetch" href="/yk_manual/assets/js/54.3a91c877.js"><link rel="prefetch" href="/yk_manual/assets/js/55.81d7cc8c.js"><link rel="prefetch" href="/yk_manual/assets/js/56.8cf81605.js"><link rel="prefetch" href="/yk_manual/assets/js/57.a41572ff.js"><link rel="prefetch" href="/yk_manual/assets/js/58.f8ff56b7.js"><link rel="prefetch" href="/yk_manual/assets/js/59.ea670ed3.js"><link rel="prefetch" href="/yk_manual/assets/js/6.656ce09e.js"><link rel="prefetch" href="/yk_manual/assets/js/60.0db1c5c3.js"><link rel="prefetch" href="/yk_manual/assets/js/61.1e4bde04.js"><link rel="prefetch" href="/yk_manual/assets/js/62.d787aa69.js"><link rel="prefetch" href="/yk_manual/assets/js/63.c37c9ffc.js"><link rel="prefetch" href="/yk_manual/assets/js/64.78b47d0e.js"><link rel="prefetch" href="/yk_manual/assets/js/65.f3b2b700.js"><link rel="prefetch" href="/yk_manual/assets/js/66.03968d86.js"><link rel="prefetch" href="/yk_manual/assets/js/67.d089aa3f.js"><link rel="prefetch" href="/yk_manual/assets/js/68.c115a8c8.js"><link rel="prefetch" href="/yk_manual/assets/js/69.c1a2722a.js"><link rel="prefetch" href="/yk_manual/assets/js/7.79bee4d1.js"><link rel="prefetch" href="/yk_manual/assets/js/70.7b2ad873.js"><link rel="prefetch" href="/yk_manual/assets/js/71.4155becb.js"><link rel="prefetch" href="/yk_manual/assets/js/72.14495a90.js"><link rel="prefetch" href="/yk_manual/assets/js/73.ac817f7f.js"><link rel="prefetch" href="/yk_manual/assets/js/74.74770b96.js"><link rel="prefetch" href="/yk_manual/assets/js/75.106557c3.js"><link rel="prefetch" href="/yk_manual/assets/js/76.1575170f.js"><link rel="prefetch" href="/yk_manual/assets/js/77.9de699f2.js"><link rel="prefetch" href="/yk_manual/assets/js/78.9746f0d1.js"><link rel="prefetch" href="/yk_manual/assets/js/79.a78e5adc.js"><link rel="prefetch" href="/yk_manual/assets/js/8.8b07aad3.js"><link rel="prefetch" href="/yk_manual/assets/js/80.5569987c.js"><link rel="prefetch" href="/yk_manual/assets/js/81.03807b1e.js"><link rel="prefetch" href="/yk_manual/assets/js/82.993a3723.js"><link rel="prefetch" href="/yk_manual/assets/js/83.45b8219b.js"><link rel="prefetch" href="/yk_manual/assets/js/84.bb6839e1.js"><link rel="prefetch" href="/yk_manual/assets/js/85.682228fd.js"><link rel="prefetch" href="/yk_manual/assets/js/86.c22b3a05.js"><link rel="prefetch" href="/yk_manual/assets/js/87.7cf40bc0.js"><link rel="prefetch" href="/yk_manual/assets/js/88.22f41047.js"><link rel="prefetch" href="/yk_manual/assets/js/89.2e1337dc.js"><link rel="prefetch" href="/yk_manual/assets/js/90.62c2de78.js"><link rel="prefetch" href="/yk_manual/assets/js/91.3cbcc56d.js"><link rel="prefetch" href="/yk_manual/assets/js/92.4b76c35c.js"><link rel="prefetch" href="/yk_manual/assets/js/93.6d7c48af.js"><link rel="prefetch" href="/yk_manual/assets/js/94.cbb3692f.js"><link rel="prefetch" href="/yk_manual/assets/js/95.ba6e311f.js"><link rel="prefetch" href="/yk_manual/assets/js/96.1fbba610.js"><link rel="prefetch" href="/yk_manual/assets/js/97.49354f13.js"><link rel="prefetch" href="/yk_manual/assets/js/98.649e4677.js"><link rel="prefetch" href="/yk_manual/assets/js/99.da2ca105.js">
    <link rel="stylesheet" href="/yk_manual/assets/css/0.styles.ac71bee4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>YK菌</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2></p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2023
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yk_manual/" class="home-link router-link-active"><!----> <span class="site-name">YK菌</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yk_manual/basics/" class="nav-link"><i class="undefined"></i>
  基础知识
</a></div><div class="nav-item"><a href="/yk_manual/fe_advance/" class="nav-link router-link-active"><i class="undefined"></i>
  前端进阶
</a></div><div class="nav-item"><a href="/yk_manual/fe_engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/yk_manual/fe_code/" class="nav-link"><i class="undefined"></i>
  技术内功
</a></div><div class="nav-item"><a href="/yk_manual/code_life/" class="nav-link"><i class="undefined"></i>
  代码人生
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yk2012" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/ykang2020" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2409780510207133/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44972008" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>92</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/yk_manual/basics/" class="nav-link"><i class="undefined"></i>
  基础知识
</a></div><div class="nav-item"><a href="/yk_manual/fe_advance/" class="nav-link router-link-active"><i class="undefined"></i>
  前端进阶
</a></div><div class="nav-item"><a href="/yk_manual/fe_engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/yk_manual/fe_code/" class="nav-link"><i class="undefined"></i>
  技术内功
</a></div><div class="nav-item"><a href="/yk_manual/code_life/" class="nav-link"><i class="undefined"></i>
  代码人生
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关注我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yk2012" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/ykang2020" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2409780510207133/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_44972008" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/yk_manual/fe_advance/typescript" class="sidebar-heading clickable open"><span>typescript</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/yk_manual/fe_advance/typescript/basics/01概述" class="sidebar-heading clickable open"><span>基础知识</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/yk_manual/fe_advance/typescript/basics/01概述.html" class="sidebar-link">概述</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/02类型声明.html" class="sidebar-link">类型声明</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/03枚举类型.html" class="sidebar-link">枚举类型</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/04配置选项.html" class="sidebar-link">配置选项</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/05webpack配置.html" class="sidebar-link">webpack配置</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/06面向对象.html" class="sidebar-link">面向对象</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/07接口.html" class="sidebar-link">接口</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/08泛型.html" class="sidebar-link">泛型</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/09类型检查机制.html" class="sidebar-link">类型检查机制</a></li><li><a href="/yk_manual/fe_advance/typescript/basics/10高级类型.html" class="sidebar-link">高级类型</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/yk_manual/fe_advance/typescript/type_challenges/01为什么叫类型体操" class="sidebar-heading clickable"><span>类型体操</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/yk_manual/fe_advance/typescript/project/01Vue项目" class="sidebar-heading clickable"><span>TS实战</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/yk_manual/fe_advance/Vue" class="sidebar-heading clickable router-link-active"><span>Vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/yk_manual/fe_advance/React" class="sidebar-heading clickable"><span>React</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2023
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title"></h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><blockquote><p>来自尚硅谷的课程笔记 课程链接 <a href="https://www.bilibili.com/video/BV1v5411H7gZ" target="_blank" rel="noopener noreferrer">尚硅谷邵山欢（考拉老师）Vue之虚拟DOM和diff算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
加入大量的注释以及大量改写，新增很多插图解释diff算法
第八章仔细说明了老师说的一些比较含糊的地方
源码链接 <a href="https://gitee.com/ykang2020/vue_learn" target="_blank" rel="noopener noreferrer">https://gitee.com/ykang2020/vue_learn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h1 id="_0-文章结构预览"><a href="#_0-文章结构预览" class="header-anchor">#</a> 0. 文章结构预览</h1> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a19736bc891d4c60b263ff5ba4b895db~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_0-1-虚拟dom如何被渲染函数-h函数-产生"><a href="#_0-1-虚拟dom如何被渲染函数-h函数-产生" class="header-anchor">#</a> 0.1 虚拟DOM如何被渲染函数（h函数）产生</h2> <p>目标：手写h函数</p> <h2 id="_0-2-diff算法的原理"><a href="#_0-2-diff算法的原理" class="header-anchor">#</a> 0.2 diff算法的原理</h2> <p>目标：手写diff算法</p> <h2 id="_0-3-虚拟dom如何通过diff变成真正的dom"><a href="#_0-3-虚拟dom如何通过diff变成真正的dom" class="header-anchor">#</a> 0.3 虚拟DOM如何通过diff变成真正的DOM</h2> <h1 id="_1-介绍"><a href="#_1-介绍" class="header-anchor">#</a> 1. 介绍</h1> <h2 id="_1-1-diff算法"><a href="#_1-1-diff算法" class="header-anchor">#</a> 1.1 diff算法</h2> <p>精细化比较
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88a07b1767f949efb41fe4695b7c685f~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_1-2-虚拟dom"><a href="#_1-2-虚拟dom" class="header-anchor">#</a> 1.2 虚拟DOM</h2> <p>本课程不涉及<strong>DOM如何变成虚拟DOM</strong>
这属于模板编译原理范畴
但是<strong>虚拟节点变成DOM节点</strong>在diff中可以做到
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d42204e5f444bbbb5767e30993ce6a0~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_1-3-关系-diff是发生在虚拟dom上的"><a href="#_1-3-关系-diff是发生在虚拟dom上的" class="header-anchor">#</a> 1.3 关系——diff是发生在虚拟DOM上的</h2> <p>新虚拟DOM和旧虚拟DOM进行diff(精细化比较)，算出应该如何最小量更新，最后反映到真正的DOM上</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d543432da6a46d1bebc10dd27e7000c~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_2-snabbdom-简介-及-准备工作"><a href="#_2-snabbdom-简介-及-准备工作" class="header-anchor">#</a> 2. snabbdom 简介 及 准备工作</h1> <h2 id="_2-1-简介"><a href="#_2-1-简介" class="header-anchor">#</a> 2.1 简介</h2> <p><code>snabbdom</code>(瑞典语，“速度”)是著名的虚拟DOM库，是diff算法的鼻祖
Vue源码借鉴了<code>snabbdom</code>
源码使用TypeScript写的<a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener noreferrer">https://github.com/snabbdom/snabbdom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
从npm下载的是build出来的JavaScript版本</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>npm install <span class="token operator">-</span>D snabbdom
</code></pre></div><h2 id="_2-2-搭建初始环境"><a href="#_2-2-搭建初始环境" class="header-anchor">#</a> 2.2 搭建初始环境</h2> <h3 id="_1-安装snabbdom"><a href="#_1-安装snabbdom" class="header-anchor">#</a> 1. 安装snabbdom</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code>cnpm install <span class="token operator">-</span>S snabbdom
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/859198a218f84a749e0cf240a5bcb415~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h3 id="_2-安装webpack5并配置"><a href="#_2-安装webpack5并配置" class="header-anchor">#</a> 2. 安装webpack5并配置</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cnpm i <span class="token operator">-</span><span class="token constant">D</span> webpack@<span class="token number">5</span> webpack<span class="token operator">-</span>cli@<span class="token number">3</span> webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server@<span class="token number">3</span>
</code></pre></div><p>配置webpack5</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// webpack5 不用配置mode</span>
  <span class="token comment">// 入口</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 出口</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 虚拟打包路径，文件夹不会真正生成，而是在8080端口虚拟生成</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;xuni&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 打包出来的文件名</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置webpack-dev-server</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 静态根目录</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'www'</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口号</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-复制官方demo-example"><a href="#_3-复制官方demo-example" class="header-anchor">#</a> 3. 复制官方demo Example</h3> <p>src/index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  init<span class="token punctuation">,</span>
  classModule<span class="token punctuation">,</span>
  propsModule<span class="token punctuation">,</span>
  styleModule<span class="token punctuation">,</span>
  eventListenersModule<span class="token punctuation">,</span>
  h<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;snabbdom&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">// Init patch function with chosen modules</span>
  classModule<span class="token punctuation">,</span> <span class="token comment">// makes it easy to toggle classes</span>
  propsModule<span class="token punctuation">,</span> <span class="token comment">// for setting properties on DOM elements</span>
  styleModule<span class="token punctuation">,</span> <span class="token comment">// handles styling on elements with support for animations</span>
  eventListenersModule<span class="token punctuation">,</span> <span class="token comment">// attaches event listeners</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div#container.two.classes&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">fontWeight</span><span class="token operator">:</span> <span class="token string">&quot;bold&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;This is bold&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot; and this is just normal text&quot;</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">&quot;/foo&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I'll take you places!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Patch into empty DOM element – this modifies the DOM as a side effect</span>
<span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newVnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span>
  <span class="token string">&quot;div#container.two.classes&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span>
      <span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">fontWeight</span><span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fontStyle</span><span class="token operator">:</span> <span class="token string">&quot;italic&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;This is now italic type&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&quot; and this is still just normal text&quot;</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">&quot;/bar&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I'll take you places!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Second `patch` invocation</span>
<span class="token function">patch</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Snabbdom efficiently updates the old view to the new state</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c44cbe95e7347e0b8c624b6656fc22a~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_3-h函数的介绍与使用"><a href="#_3-h函数的介绍与使用" class="header-anchor">#</a> 3. h函数的介绍与使用</h1> <h2 id="_3-1-介绍"><a href="#_3-1-介绍" class="header-anchor">#</a> 3.1 介绍</h2> <p>用来产生虚拟节点(vnode)
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d140927edd05442985cd9abf41d55278~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述">
虚拟节点vnode的属性</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token comment">// 子元素 数组</span>
	<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 属性、样式、key</span>
	<span class="token literal-property property">elm</span><span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token comment">// 对应的真正的dom节点(对象)，undefined表示节点还没有上dom树</span>
	<span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token comment">// 唯一标识</span>
	<span class="token literal-property property">sel</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 选择器</span>
	<span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 文本内容</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-2-使用h函数-创建虚拟节点"><a href="#_3-2-使用h函数-创建虚拟节点" class="header-anchor">#</a> 3.2 使用h函数 创建虚拟节点</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建虚拟节点</span>
<span class="token keyword">var</span> myVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'YK菌'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myVnode1<span class="token punctuation">)</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5450d367047142b988edaec7848631f8~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_3-3-使用patch函数-将虚拟节点上dom树"><a href="#_3-3-使用patch函数-将虚拟节点上dom树" class="header-anchor">#</a> 3.3 使用patch函数 将虚拟节点上DOM树</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建patch函数</span>
<span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  classModule<span class="token punctuation">,</span>
  propsModule<span class="token punctuation">,</span>
  styleModule<span class="token punctuation">,</span>
  eventListenersModule<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建虚拟节点</span>
<span class="token keyword">var</span> myVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span>
  <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">&quot;https://www.baidu.com&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;_blank&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;YK菌&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 让虚拟节点上树</span>
<span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> myVnode1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76a7c7fa4425463f94f0961c98fe8b4b~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_3-4-h函数嵌套使用-得到虚拟dom树-重要"><a href="#_3-4-h函数嵌套使用-得到虚拟dom树-重要" class="header-anchor">#</a> 3.4 h函数嵌套使用，得到虚拟DOM树（重要）</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c4569a3ad14400eb12a0960ab274959~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> myVnode3 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'苹果'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'香蕉'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'西瓜'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'番茄'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 让虚拟节点上树</span>
<span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> myVnode3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c0781bca5e747ffab2ebede725c3743~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> myVnode3 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'苹果'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'香蕉'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'草莓'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span><span class="token string">'西瓜'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'番茄'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/094a6fa266814a638a08794de4344953~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/22b1dc664a6c4fb2adfa1b7107df3709~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_4-手写h函数"><a href="#_4-手写h函数" class="header-anchor">#</a> 4. 手写h函数</h1> <h2 id="vnode-js"><a href="#vnode-js" class="header-anchor">#</a> vnode.js</h2> <p>将传入的参数组合成对象返回</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 产生虚拟节点
 * 将传入的参数组合成对象返回
 * @param {string} sel 选择器
 * @param {object} data 属性、样式
 * @param {Array} children 子元素
 * @param {string|number} text 文本内容
 * @param {object} elm 对应的真正的dom节点(对象)，undefined表示节点还没有上dom树
 * @returns 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="h-js"><a href="#h-js" class="header-anchor">#</a> h.js</h2> <p>产生虚拟DOM树，返回的是一个对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> vnode <span class="token keyword">from</span> <span class="token string">&quot;./vnode&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 产生虚拟DOM树，返回的一个对象
 * 低配版本的h函数，这个函数必须接受三个参数，缺一不可
 * @param {*} sel
 * @param {*} data
 * @param {*} c
 * 调用只有三种形态 文字、数组、h函数
 * ① h('div', {}, '文字')
 * ② h('div', {}, [])
 * ③ h('div', {}, h())
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 检查参数个数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;请传且只传入三个参数！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 检查第三个参数 c 的类型</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> c <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> c <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明现在是 ① 文字</span>
    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明是 ② 数组</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历 c 数组</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> item <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;sel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;传入的数组有不是h函数的项&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 不用执行item, 只要收集数组中的每一个对象</span>
      children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> c <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;sel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明是 ③ h函数 是一个对象（h函数返回值是一个对象）放到children数组中就行了</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;传入的参数类型不对！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="index-js"><a href="#index-js" class="header-anchor">#</a> index.js</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> h <span class="token keyword">from</span> <span class="token string">&quot;./my_snabbdom/h&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;嘻嘻&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;哈哈&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'呵呵'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myVnode1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="效果展示"><a href="#效果展示" class="header-anchor">#</a> 效果展示</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90f14e0f6aeb410daa3bdbb5c5a177f1~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_5-手写diff算法准备"><a href="#_5-手写diff算法准备" class="header-anchor">#</a> 5. 手写diff算法准备</h1> <h2 id="_5-1-diff算法原理"><a href="#_5-1-diff算法原理" class="header-anchor">#</a> 5.1 diff算法原理</h2> <p>最小量更新，<code>key</code>很关键。<code>key</code>是这个节点的唯一标识，告诉diff算法，在更改前后它们是同一个DOM节点。</p> <p><strong>只是同一个虚拟节点，才进行精细化比较</strong>（往ul中的 li 添加 li），否则就是暴力删除旧的、插入新的（ul中的li 换到在 ol 中去）</p> <p>问题： 如何定义是同一个虚拟节点
答：<strong>选择器相同且key相同</strong></p> <p><strong>只进行同层比较，不会进行跨层比较</strong>。即使是同一片	虚拟节点，但是跨层了，diff就是暴力删除旧的，然后插入新的</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d675e4f6dbd441e3aabea0d1a38dff71~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c72099f725284599a686d386e8c35f4e~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_5-2-手写diff预备"><a href="#_5-2-手写diff预备" class="header-anchor">#</a> 5.2 手写diff预备</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ff87a0a180240edb3bfb9840402edf1~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h3 id="_5-2-1-源码中如何定义-同一个节点"><a href="#_5-2-1-源码中如何定义-同一个节点" class="header-anchor">#</a> 5.2.1 源码中如何定义“同一个节点”</h3> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23fb547168004615ae6f3720b5b77818~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h3 id="_5-2-2-源码中创建子节点-需要递归"><a href="#_5-2-2-源码中创建子节点-需要递归" class="header-anchor">#</a> 5.2.2 源码中创建子节点，需要递归</h3> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/926169d6df294b578b3accc621a2e902~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_6-手写diff-首次上dom树patch-container-myvnode1"><a href="#_6-手写diff-首次上dom树patch-container-myvnode1" class="header-anchor">#</a> 6. 手写diff——首次上DOM树<code>patch(container, myVnode1)</code></h1> <h2 id="_6-0-dom-预备知识"><a href="#_6-0-dom-预备知识" class="header-anchor">#</a> 6.0 DOM 预备知识</h2> <h3 id="_6-0-1-node-insertbefore"><a href="#_6-0-1-node-insertbefore" class="header-anchor">#</a> 6.0.1 Node.insertBefore()</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> insertedNode <span class="token operator">=</span> parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> referenceNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>insertedNode</code> ：被插入节点(<code>newNode</code>)
<code>parentNode</code> ：新插入节点的父节点
<code>newNode</code> ：用于插入的节点
<code>referenceNode</code>  ：<code>newNode</code> 将要插在这个节点之前
在当前节点下增加一个子节点 <code>Node</code>，并使该子节点位于参考节点的前面。</p> <h3 id="_6-0-2-node-appendchild"><a href="#_6-0-2-node-appendchild" class="header-anchor">#</a> 6.0.2 Node.appendChild()</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>aChild<span class="token punctuation">)</span>
</code></pre></div><p>将一个节点附加到指定父节点的子节点列表的末尾处。
如果将被插入的节点已经存在于当前文档的文档树中，那么 <code>appendChild()</code> 只会将它从原先的位置移动到新的位置（不需要事先移除要移动的节点）。</p> <h3 id="_6-0-3-element-tagname"><a href="#_6-0-3-element-tagname" class="header-anchor">#</a> 6.0.3 Element.tagName</h3> <p>返回当前元素的标签名</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>elementName <span class="token operator">=</span> element<span class="token punctuation">.</span>tagName
</code></pre></div><p><code>elementName</code> 是一个字符串,包含了element元素的标签名.
在HTML文档中, <code>tagName</code>会返回其<strong>大写形式</strong></p> <h3 id="_6-0-4-node-removechild"><a href="#_6-0-4-node-removechild" class="header-anchor">#</a> 6.0.4 Node.removeChild</h3> <p>从DOM中删除一个子节点。返回删除的节点</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> oldChild <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//OR</span>

element<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>child</code> 是要移除的那个子节点.
<code>node</code> 是child的父节点.
<code>oldChild</code>保存对删除的子节点的引用. <code>oldChild === child.</code></p> <h3 id="_6-0-5-document-createelement"><a href="#_6-0-5-document-createelement" class="header-anchor">#</a> 6.0.5 document.createElement</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>tagName</code>：指定要创建<strong>元素类型</strong>的字符串, 创建元素时的 nodeName 使用 tagName 的值为初始化，该方法不允许使用限定名称(如:&quot;html:a&quot;)，在 HTML 文档上调用 createElement() 方法创建元素之前会将tagName 转化成小写，在 Firefox、Opera 和 Chrome 内核中，createElement(null) 等同于 createElement(&quot;null&quot;)
<code>返回</code> 新建的元素（Element）</p> <h2 id="_6-1-patch-js"><a href="#_6-1-patch-js" class="header-anchor">#</a> 6.1 patch.js</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> vnode <span class="token keyword">from</span> <span class="token string">&quot;./vnode&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createElement <span class="token keyword">from</span> <span class="token string">&quot;./createElement&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> newVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断传入的第一个参数是 DOM节点 还是 虚拟节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>sel <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> oldVnode<span class="token punctuation">.</span>sel <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明oldVnode是DOM节点，此时要包装成虚拟节点</span>
    oldVnode <span class="token operator">=</span> <span class="token function">vnode</span><span class="token punctuation">(</span>
      oldVnode<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// sel</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// data</span>
      <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// children</span>
      <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">// text</span>
      oldVnode <span class="token comment">// elm</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 判断 oldVnode 和 newVnode 是不是同一个节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>sel <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;是同一个节点，需要精细化比较&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;不是同一个节点，暴力 插入新节点，删除旧节点&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建 新虚拟节点 为 DOM节点</span>
    <span class="token comment">// 要操作DOM，所以都要转换成 DOM节点</span>
    <span class="token keyword">let</span> newVnodeElm <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> oldVnodeElm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    <span class="token comment">// 插入 新节点 到 旧节点 之前</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVnodeElm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断newVnodeElm是存在的 在旧节点之前插入新节点</span>
      oldVnodeElm<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newVnodeElm<span class="token punctuation">,</span> oldVnodeElm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 删除旧节点</span>
    oldVnodeElm<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldVnodeElm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-2-createelement-js"><a href="#_6-2-createelement-js" class="header-anchor">#</a> 6.2 createElement.js</h2> <p>创建节点。将vnode虚拟节点创建为DOM节点</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 创建节点。将vnode虚拟节点创建为DOM节点
 * 是孤儿节点，不进行插入操作
 * @param {object} vnode
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 根据虚拟节点sel选择器属性 创建一个DOM节点，这个节点现在是孤儿节点</span>
  <span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 判断是有子节点还是有文本</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    vnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明没有子节点，内部是文本</span>
    domNode<span class="token punctuation">.</span>innerText <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明内部是子节点，需要递归创建节点 </span>
    <span class="token comment">// 遍历数组</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> ch <span class="token keyword">of</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 递归调用 创建出它的DOM，一旦调用createElement意味着创建出DOM了。并且它的elm属性指向了创建出的dom，但是没有上树，是一个孤儿节点</span>
      <span class="token keyword">let</span> chDOM <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 得到 子节点 表示的 DOM节点 递归最后返回的一定是文本节点</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 文本节点 上domNode树</span>
      domNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>chDOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 补充虚拟节点的elm属性</span>
  vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> domNode<span class="token punctuation">;</span>
  <span class="token comment">// 返回domNode DOM对象</span>
  <span class="token keyword">return</span> domNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-3-index-js"><a href="#_6-3-index-js" class="header-anchor">#</a> 6.3 index.js</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> h <span class="token keyword">from</span> <span class="token string">&quot;./my_snabbdom/h&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> patch <span class="token keyword">from</span> <span class="token string">&quot;./my_snabbdom/patch&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// const myVnode1 = h(&quot;h1&quot;, {}, &quot;你好&quot;);</span>

<span class="token keyword">const</span> myVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上树</span>
<span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> myVnode1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-4-展示效果"><a href="#_6-4-展示效果" class="header-anchor">#</a> 6.4 展示效果</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eaa2a5ac8c0e499daec9e9711c343fb6~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_7-处理新旧节点-是同一个节点-的情况"><a href="#_7-处理新旧节点-是同一个节点-的情况" class="header-anchor">#</a> 7. 处理新旧节点 是同一个节点 的情况</h1> <h2 id="_7-1-分析"><a href="#_7-1-分析" class="header-anchor">#</a> 7.1 分析</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3cff6286436742ad8407feb2f19592fb~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_7-2-实现-新旧节点text不同情况"><a href="#_7-2-实现-新旧节点text不同情况" class="header-anchor">#</a> 7.2 实现 新旧节点text不同情况</h2> <h3 id="_7-2-1-patch-js"><a href="#_7-2-1-patch-js" class="header-anchor">#</a> 7.2.1 patch.js</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 判断 oldVnode 和 newVnode 是不是同一个节点</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>sel <span class="token operator">===</span> newVnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;是同一个节点，需要精细化比较&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2-3-patchvnode-js"><a href="#_7-2-3-patchvnode-js" class="header-anchor">#</a> 7.2.3 patchVnode.js</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> newVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 判断新旧 vnode 是否是同一个对象</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> newVnode<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token comment">// 2. 判断 newVndoe 有没有 text 属性</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    newVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>newVnode<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> newVnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// newVnode 有 text 属性</span>
    <span class="token comment">// 2.1 判断 newVnode 与 oldVnode 的 text 属性是否相同</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果newVnode中的text和oldVnode的text不同，那么直接让新text写入老elm中即可。</span>
      <span class="token comment">// 如果oldVnode中是children，也会立即消失</span>
      oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>innerText <span class="token operator">=</span> newVnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// newVnode 没有text属性 有children属性</span>
    <span class="token comment">// 2.2 判断 oldVnode 有没有 children 属性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// oldVnode有children属性 最复杂的情况，新老节点都有children</span>
 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// oldVnode没有children属性 说明有text;  newVnode有children属性</span>
      <span class="token comment">// 清空oldVnode的内容</span>
      oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token comment">// 遍历新的vnode虚拟节点的子节点，创建DOM，上树</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> ch <span class="token keyword">of</span> newVnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> chDOM <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>chDOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2-2-index-js"><a href="#_7-2-2-index-js" class="header-anchor">#</a> 7.2.2 index.js</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> h <span class="token keyword">from</span> <span class="token string">&quot;./my_snabbdom/h&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> patch <span class="token keyword">from</span> <span class="token string">&quot;./my_snabbdom/patch&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myVnode1 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上树</span>
<span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> myVnode1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myVnode2 <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>myVnode1<span class="token punctuation">,</span> myVnode2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-3-展示"><a href="#_7-3-展示" class="header-anchor">#</a> 7.3 展示</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/283f9cc1676d43e8a272e2c0b6801f34~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h1 id="_8-分析-diff算法-更新子节点操作-重要"><a href="#_8-分析-diff算法-更新子节点操作-重要" class="header-anchor">#</a> 8. 分析 diff算法 更新子节点操作（重要）</h1> <p>这里老师ppt有问题，③应该不是新前而是新后
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd274d0c7da04645a93dda4d4135ed1b~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ffd852596674c6c9e2c0f9803714413~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <h2 id="_8-1-循环四种命中查找"><a href="#_8-1-循环四种命中查找" class="header-anchor">#</a> 8.1 循环四种命中查找</h2> <h3 id="_1-比较-1-新前newstart-与-旧前oldstart"><a href="#_1-比较-1-新前newstart-与-旧前oldstart" class="header-anchor">#</a> 1. 比较 ① 新前newStart 与 旧前oldStart</h3> <p>如果命中①了，patch之后就移动头指针 newStart++  oldStart++
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04137e60b3bf470d847d97c075bcf8bd~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新前与旧前</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ①1 新前与旧前 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 精细化比较两个节点 oldStartVnode现在和newStartVnode一样了</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 移动指针，改变指针指向的节点，这表示这两个节点都处理（比较）完了</span>
    oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果没命中就接着比较下一种情况</p> <h3 id="_2-比较-2-新后newend-与-旧后-oldend"><a href="#_2-比较-2-新后newend-与-旧后-oldend" class="header-anchor">#</a> 2. 比较 ② 新后newEnd 与 旧后 oldEnd</h3> <p>如果命中②了，patch后就移动尾指针 newEnd-- oldEnd--
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec4f32f77fd84ab5b335500a02d2b817~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果没命中就接着比较下一种情况</p> <h3 id="_3-比较-3-新后newend-与-旧前oldstart"><a href="#_3-比较-3-新后newend-与-旧前oldstart" class="header-anchor">#</a> 3. 比较 ③ 新后newEnd 与 旧前oldStart</h3> <p>如果命中③了，将 新后newEnd 指向的节点移动到 旧后oldEnd 之后
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/472e8fdb66c74ef8a92831dc7cfe4ade~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新后与旧前</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ③3 新后与旧前 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当③新后与旧前命中的时候，此时要移动节点。移动 新后（旧前） 指向的这个节点到老节点的 旧后的后面</span>
    <span class="token comment">// 移动节点：只要插入一个已经在DOM树上 的节点，就会被移动</span>
    parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="命中3复杂情况举例-倒序"><a href="#命中3复杂情况举例-倒序" class="header-anchor">#</a> 命中③复杂情况举例——倒序</h4> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c799b478104840cd99b8943d39c8cb9b~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <p>如果没命中就接着比较下一种情况</p> <h3 id="_4-比较-4-新前newstart-与-旧后oldend"><a href="#_4-比较-4-新前newstart-与-旧后oldend" class="header-anchor">#</a> 4. 比较 ④ 新前newStart 与 旧后oldEnd</h3> <p>如果命中④了，将 新前newStart 指向的节点，移动到 旧前oldStart 之前
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1599fa75be442d1ac58fbf9f388c05c~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新前与旧后</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ④4 新前与旧后 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当④新前与旧后命中的时候，此时要移动节点。移动 新前（旧后） 指向的这个节点到老节点的 旧前的前面</span>
    <span class="token comment">// 移动节点：只要插入一个已经在DOM树上的节点，就会被移动</span>
    parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果没命中就表示四种情况都没有命中</p> <h3 id="_5-四种都没命中-遍历oldvnode中的key"><a href="#_5-四种都没命中-遍历oldvnode中的key" class="header-anchor">#</a> 5. 四种都没命中 遍历oldVnode中的key</h3> <p>找到了就 移动位置 移动指针newStart++
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/714e2ef56b5c4cb091c0169a52b5932c~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述">
没找的就是新节点，直接插入所有未处理旧节点之前</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 四种都没有匹配到，都没有命中</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;四种都没有命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 寻找 keyMap 一个映射对象， 就不用每次都遍历old对象了</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  keyMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 记录oldVnode中的节点出现的key</span>
  <span class="token comment">// 从oldStartIdx开始到oldEndIdx结束，创建keyMap</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      keyMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 寻找当前项（newStartIdx）在keyMap中映射的序号</span>
<span class="token keyword">const</span> idxInOld <span class="token operator">=</span> keyMap<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>idxInOld <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果 idxInOld 是 undefined 说明是全新的项，要插入</span>
  <span class="token comment">// 被加入的项（就是newStartVnode这项)现不是真正的DOM节点</span>
  parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 说明不是全新的项，要移动</span>
  <span class="token keyword">const</span> elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 把这项设置为undefined，表示我已经处理完这项了</span>
  oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">// 移动，调用insertBefore也可以实现移动。</span>
  parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// newStartIdx++;</span>
newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-2-循环结束"><a href="#_8-2-循环结束" class="header-anchor">#</a> 8.2 循环结束</h2> <p>结束后</p> <ol><li>newVnode中还有剩余
新节点中剩余的都 <strong>插入</strong> 旧节点oldEnd后面 或 oldStart之前
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe86e10328c540f4a479221c5e6a308f~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c071b57f8094954a0aa3eb3cdb16bf1~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></li> <li>oldVnode中还有剩余节点
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b242091eefd5432fb4e935f881cb1236~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1daacde5fd4b4417ac7189de432152e1~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1998d05477a24089b6e93ed95e0ce5f6~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 循环结束</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 说明newVndoe还有剩余节点没有处理，所以要添加这些节点</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// insertBefore方法可以自动识别null，如果是null就会自动排到队尾，和appendChild一致</span>
    parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">[</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 说明oldVnode还有剩余节点没有处理，所以要删除这些节点</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_9-手写diff更新子节点操作"><a href="#_9-手写diff更新子节点操作" class="header-anchor">#</a> 9. 手写diff更新子节点操作</h1> <h2 id="patchvnode-js"><a href="#patchvnode-js" class="header-anchor">#</a> patchVnode.js</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 2.2 判断 oldVnode 有没有 children 属性</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// oldVnode有children属性 最复杂的情况，新老节点都有children</span>
  <span class="token function">updateChildren</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">,</span> newVnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="updatechildren-js"><a href="#updatechildren-js" class="header-anchor">#</a> updateChildren.js</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> createElement <span class="token keyword">from</span> <span class="token string">&quot;./createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> patchVnode <span class="token keyword">from</span> <span class="token string">&quot;./patchVnode&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 
 * @param {object} parentElm Dom节点
 * @param {Array} oldCh oldVnode的子节点数组
 * @param {Array} newCh newVnode的子节点数组
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;updateChildren()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 四个指针</span>
  <span class="token comment">// 旧前</span>
  <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// 新前</span>
  <span class="token keyword">let</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// 旧后</span>
  <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// 新后</span>
  <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment">// 指针指向的四个节点</span>
  <span class="token comment">// 旧前节点</span>
  <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 旧后节点</span>
  <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 新前节点</span>
  <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 新后节点</span>
  <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> keyMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;**循环中**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 首先应该不是判断四种命中，而是略过已经加了undefined标记的项</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartVnode <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> oldCh<span class="token punctuation">[</span>oldStartIdx<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEndVnode <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartVnode <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> newCh<span class="token punctuation">[</span>newStartIdx<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEndVnode <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 新前与旧前</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ①1 新前与旧前 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 精细化比较两个节点 oldStartVnode现在和newStartVnode一样了</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 移动指针，改变指针指向的节点，这表示这两个节点都处理（比较）完了</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 新后与旧后</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ②2 新后与旧后 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 新后与旧前</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ③3 新后与旧前 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 当③新后与旧前命中的时候，此时要移动节点。移动 新后（旧前） 指向的这个节点到老节点的 旧后的后面</span>
      <span class="token comment">// 移动节点：只要插入一个已经在DOM树上 的节点，就会被移动</span>
      parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 新前与旧后</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; ④4 新前与旧后 命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 当④新前与旧后命中的时候，此时要移动节点。移动 新前（旧后） 指向的这个节点到老节点的 旧前的前面</span>
      <span class="token comment">// 移动节点：只要插入一个已经在DOM树上的节点，就会被移动</span>
      parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 四种都没有匹配到，都没有命中</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;四种都没有命中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 寻找 keyMap 一个映射对象， 就不用每次都遍历old对象了</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keyMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        keyMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 记录oldVnode中的节点出现的key</span>
        <span class="token comment">// 从oldStartIdx开始到oldEndIdx结束，创建keyMap</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> key <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            keyMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 寻找当前项（newStartIdx）在keyMap中映射的序号</span>
      <span class="token keyword">const</span> idxInOld <span class="token operator">=</span> keyMap<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>idxInOld <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果 idxInOld 是 undefined 说明是全新的项，要插入</span>
        <span class="token comment">// 被加入的项（就是newStartVnode这项)现不是真正的DOM节点</span>
        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 说明不是全新的项，要移动</span>
        <span class="token keyword">const</span> elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把这项设置为undefined，表示我已经处理完这项了</span>
        oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token comment">// 移动，调用insertBefore也可以实现移动。</span>
        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// newStartIdx++;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 循环结束</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明newVndoe还有剩余节点没有处理，所以要添加这些节点</span>
    <span class="token comment">// // 插入的标杆</span>
    <span class="token comment">// const before =</span>
    <span class="token comment">//   newCh[newEndIdx + 1] === null ? null : newCh[newEndIdx + 1].elm;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// insertBefore方法可以自动识别null，如果是null就会自动排到队尾，和appendChild一致</span>
      parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">[</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 说明oldVnode还有剩余节点没有处理，所以要删除这些节点</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 判断是否是同一个节点</span>
<span class="token keyword">function</span> <span class="token function">checkSameVnode</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token punctuation">.</span>sel <span class="token operator">===</span> b<span class="token punctuation">.</span>sel <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>源码链接 <a href="https://gitee.com/ykang2020/vue_learn" target="_blank" rel="noopener noreferrer">https://gitee.com/ykang2020/vue_learn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad7b9cc75b7d40409da5ca97209251c1~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述"></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2022/4/13 12:52:30</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/yk_manual/fe_advance/Vue/vue_src/01模板引擎.html" class="prev">
            模板引擎
          </a></span> <span class="next"><a href="/yk_manual/fe_advance/Vue/vue_src/03数据响应.html">
            数据响应
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_0-1-虚拟dom如何被渲染函数-h函数-产生" class="sidebar-link reco-side-_0-1-虚拟dom如何被渲染函数-h函数-产生" data-v-cb1513f6>0.1 虚拟DOM如何被渲染函数（h函数）产生</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_0-2-diff算法的原理" class="sidebar-link reco-side-_0-2-diff算法的原理" data-v-cb1513f6>0.2 diff算法的原理</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_0-3-虚拟dom如何通过diff变成真正的dom" class="sidebar-link reco-side-_0-3-虚拟dom如何通过diff变成真正的dom" data-v-cb1513f6>0.3 虚拟DOM如何通过diff变成真正的DOM</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_1-1-diff算法" class="sidebar-link reco-side-_1-1-diff算法" data-v-cb1513f6>1.1 diff算法</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_1-2-虚拟dom" class="sidebar-link reco-side-_1-2-虚拟dom" data-v-cb1513f6>1.2 虚拟DOM</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_1-3-关系-diff是发生在虚拟dom上的" class="sidebar-link reco-side-_1-3-关系-diff是发生在虚拟dom上的" data-v-cb1513f6>1.3 关系——diff是发生在虚拟DOM上的</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_2-1-简介" class="sidebar-link reco-side-_2-1-简介" data-v-cb1513f6>2.1 简介</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_2-2-搭建初始环境" class="sidebar-link reco-side-_2-2-搭建初始环境" data-v-cb1513f6>2.2 搭建初始环境</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_1-安装snabbdom" class="sidebar-link reco-side-_1-安装snabbdom" data-v-cb1513f6>1. 安装snabbdom</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_2-安装webpack5并配置" class="sidebar-link reco-side-_2-安装webpack5并配置" data-v-cb1513f6>2. 安装webpack5并配置</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-复制官方demo-example" class="sidebar-link reco-side-_3-复制官方demo-example" data-v-cb1513f6>3. 复制官方demo Example</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-1-介绍" class="sidebar-link reco-side-_3-1-介绍" data-v-cb1513f6>3.1 介绍</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-2-使用h函数-创建虚拟节点" class="sidebar-link reco-side-_3-2-使用h函数-创建虚拟节点" data-v-cb1513f6>3.2 使用h函数 创建虚拟节点</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-3-使用patch函数-将虚拟节点上dom树" class="sidebar-link reco-side-_3-3-使用patch函数-将虚拟节点上dom树" data-v-cb1513f6>3.3 使用patch函数 将虚拟节点上DOM树</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-4-h函数嵌套使用-得到虚拟dom树-重要" class="sidebar-link reco-side-_3-4-h函数嵌套使用-得到虚拟dom树-重要" data-v-cb1513f6>3.4 h函数嵌套使用，得到虚拟DOM树（重要）</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#vnode-js" class="sidebar-link reco-side-vnode-js" data-v-cb1513f6>vnode.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#h-js" class="sidebar-link reco-side-h-js" data-v-cb1513f6>h.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#index-js" class="sidebar-link reco-side-index-js" data-v-cb1513f6>index.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#效果展示" class="sidebar-link reco-side-效果展示" data-v-cb1513f6>效果展示</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_5-1-diff算法原理" class="sidebar-link reco-side-_5-1-diff算法原理" data-v-cb1513f6>5.1 diff算法原理</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_5-2-手写diff预备" class="sidebar-link reco-side-_5-2-手写diff预备" data-v-cb1513f6>5.2 手写diff预备</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_5-2-1-源码中如何定义-同一个节点" class="sidebar-link reco-side-_5-2-1-源码中如何定义-同一个节点" data-v-cb1513f6>5.2.1 源码中如何定义“同一个节点”</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_5-2-2-源码中创建子节点-需要递归" class="sidebar-link reco-side-_5-2-2-源码中创建子节点-需要递归" data-v-cb1513f6>5.2.2 源码中创建子节点，需要递归</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-dom-预备知识" class="sidebar-link reco-side-_6-0-dom-预备知识" data-v-cb1513f6>6.0 DOM 预备知识</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-1-node-insertbefore" class="sidebar-link reco-side-_6-0-1-node-insertbefore" data-v-cb1513f6>6.0.1 Node.insertBefore()</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-2-node-appendchild" class="sidebar-link reco-side-_6-0-2-node-appendchild" data-v-cb1513f6>6.0.2 Node.appendChild()</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-3-element-tagname" class="sidebar-link reco-side-_6-0-3-element-tagname" data-v-cb1513f6>6.0.3 Element.tagName</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-4-node-removechild" class="sidebar-link reco-side-_6-0-4-node-removechild" data-v-cb1513f6>6.0.4 Node.removeChild</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-0-5-document-createelement" class="sidebar-link reco-side-_6-0-5-document-createelement" data-v-cb1513f6>6.0.5 document.createElement</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-1-patch-js" class="sidebar-link reco-side-_6-1-patch-js" data-v-cb1513f6>6.1 patch.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-2-createelement-js" class="sidebar-link reco-side-_6-2-createelement-js" data-v-cb1513f6>6.2 createElement.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-3-index-js" class="sidebar-link reco-side-_6-3-index-js" data-v-cb1513f6>6.3 index.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_6-4-展示效果" class="sidebar-link reco-side-_6-4-展示效果" data-v-cb1513f6>6.4 展示效果</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-1-分析" class="sidebar-link reco-side-_7-1-分析" data-v-cb1513f6>7.1 分析</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-2-实现-新旧节点text不同情况" class="sidebar-link reco-side-_7-2-实现-新旧节点text不同情况" data-v-cb1513f6>7.2 实现 新旧节点text不同情况</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-2-1-patch-js" class="sidebar-link reco-side-_7-2-1-patch-js" data-v-cb1513f6>7.2.1 patch.js</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-2-3-patchvnode-js" class="sidebar-link reco-side-_7-2-3-patchvnode-js" data-v-cb1513f6>7.2.3 patchVnode.js</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-2-2-index-js" class="sidebar-link reco-side-_7-2-2-index-js" data-v-cb1513f6>7.2.2 index.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_7-3-展示" class="sidebar-link reco-side-_7-3-展示" data-v-cb1513f6>7.3 展示</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_8-1-循环四种命中查找" class="sidebar-link reco-side-_8-1-循环四种命中查找" data-v-cb1513f6>8.1 循环四种命中查找</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_1-比较-1-新前newstart-与-旧前oldstart" class="sidebar-link reco-side-_1-比较-1-新前newstart-与-旧前oldstart" data-v-cb1513f6>1. 比较 ① 新前newStart 与 旧前oldStart</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_2-比较-2-新后newend-与-旧后-oldend" class="sidebar-link reco-side-_2-比较-2-新后newend-与-旧后-oldend" data-v-cb1513f6>2. 比较 ② 新后newEnd 与 旧后 oldEnd</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_3-比较-3-新后newend-与-旧前oldstart" class="sidebar-link reco-side-_3-比较-3-新后newend-与-旧前oldstart" data-v-cb1513f6>3. 比较 ③ 新后newEnd 与 旧前oldStart</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_4-比较-4-新前newstart-与-旧后oldend" class="sidebar-link reco-side-_4-比较-4-新前newstart-与-旧后oldend" data-v-cb1513f6>4. 比较 ④ 新前newStart 与 旧后oldEnd</a></li><li class="level-3" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_5-四种都没命中-遍历oldvnode中的key" class="sidebar-link reco-side-_5-四种都没命中-遍历oldvnode中的key" data-v-cb1513f6>5. 四种都没命中 遍历oldVnode中的key</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#_8-2-循环结束" class="sidebar-link reco-side-_8-2-循环结束" data-v-cb1513f6>8.2 循环结束</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#patchvnode-js" class="sidebar-link reco-side-patchvnode-js" data-v-cb1513f6>patchVnode.js</a></li><li class="level-2" data-v-cb1513f6><a href="/yk_manual/fe_advance/Vue/vue_src/02diff.html#updatechildren-js" class="sidebar-link reco-side-updatechildren-js" data-v-cb1513f6>updateChildren.js</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><canvas id="vuepress-canvas-cursor"></canvas><div></div></div></div>
    <script src="/yk_manual/assets/js/app.1e74c93b.js" defer></script><script src="/yk_manual/assets/js/3.7830d0fe.js" defer></script><script src="/yk_manual/assets/js/1.caa73dc8.js" defer></script><script src="/yk_manual/assets/js/183.05a1f13a.js" defer></script><script src="/yk_manual/assets/js/9.94359d55.js" defer></script>
  </body>
</html>
