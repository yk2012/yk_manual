(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{627:function(t,a,s){"use strict";s.r(a);var n=s(7),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_1-源码目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-源码目录结构"}},[t._v("#")]),t._v(" 1. 源码目录结构")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("├── /dist/ # 项目输出目录\n├── /lib/ # 项目源码目录\n│ ├── /adapters/ # 定义请求的适配器xhr、http\n│ │ ├── http.js # 实现http 适配器(包装http 包)\n│ │ └── xhr.js # 实现xhr 适配器(包装xhr 对象)\n│ ├── /cancel/ # 定义取消功能\n│ ├── /core/ # 一些核心功能\n│ │ ├── Axios.js # axios 的核心主类\n│ │ ├── dispatchRequest.js # 用来调用http 请求适配器方法发送请求的函数\n│ │ ├── InterceptorManager.js # 拦截器的管理器\n│ │ └── settle.js # 根据http 响应状态，改变Promise 的状态\n│ ├── /helpers/ # 一些辅助方法\n│ ├── axios.js # 对外暴露接口\n│ ├── defaults.js # axios 的默认配置\n│ └── utils.js # 公用工具\n├── package.json # 项目信息\n├── index.d.ts # 配置TypeScript 的声明文件\n└── index.js # 入口文件\n")])])]),s("h1",{attrs:{id:"_2-源码分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-源码分析"}},[t._v("#")]),t._v(" 2. 源码分析")]),t._v(" "),s("h3",{attrs:{id:"_2-1-axios-与axios-的关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-axios-与axios-的关系"}},[t._v("#")]),t._v(" 2.1 axios 与Axios 的关系?")]),t._v(" "),s("ol",[s("li",[t._v("从语法上来说: axios 不是Axios 的实例")]),t._v(" "),s("li",[t._v("从功能上来说: axios 是Axios 的实例")]),t._v(" "),s("li",[t._v("axios 是Axios.prototype.request 函数bind()返回的函数")]),t._v(" "),s("li",[t._v("axios 作为对象有Axios 原型对象上的所有方法, 有Axios 对象上所有属性")])]),t._v(" "),s("h3",{attrs:{id:"_2-2-instance-与axios-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-instance-与axios-的区别"}},[t._v("#")]),t._v(" 2.2 instance 与axios 的区别?")]),t._v(" "),s("ol",[s("li",[t._v("相同:\n(1) 都是一个能发任意请求的函数: request(config)\n(2) 都有发特定请求的各种方法: get()/post()/put()/delete()\n(3) 都有默认配置和拦截器的属性: defaults/interceptors")]),t._v(" "),s("li",[t._v("不同:\n(1) 默认匹配的值很可能不一样\n(2) instance 没有axios 后面添加的一些方法: create()/CancelToken()/all()")])]),t._v(" "),s("h3",{attrs:{id:"_2-3-axios-运行的整体流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-axios-运行的整体流程"}},[t._v("#")]),t._v(" 2.3. axios 运行的整体流程?")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210302162057950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),t._v(" "),s("h4",{attrs:{id:"_1-整体流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-整体流程"}},[t._v("#")]),t._v(" 1. 整体流程:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xhrAdapter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"_2-request-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-request-config"}},[t._v("#")]),t._v(" 2. request(config):")]),t._v(" "),s("p",[t._v("将请求拦截器/ dispatchRequest() / 响应拦截器通过promise 链串连起来,返回promise")]),t._v(" "),s("h4",{attrs:{id:"_3-dispatchrequest-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-dispatchrequest-config"}},[t._v("#")]),t._v(" 3. dispatchRequest(config):")]),t._v(" "),s("p",[t._v("转换请求数据 ===> 调用xhrAdapter()发请求 ===> 请求返回后转换响应数据. 返回promise")]),t._v(" "),s("h4",{attrs:{id:"_4-xhradapter-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-xhradapter-config"}},[t._v("#")]),t._v(" 4. xhrAdapter(config):")]),t._v(" "),s("p",[t._v("创建XHR 对象, 根据config 进行相应设置, 发送特定请求, 并接收响应数据,返回promise")]),t._v(" "),s("h3",{attrs:{id:"_2-4-axios-的请求-响应拦截器是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-axios-的请求-响应拦截器是什么"}},[t._v("#")]),t._v(" 2.4. axios 的请求/响应拦截器是什么?")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210302162129252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),t._v(" "),s("h4",{attrs:{id:"_1-请求拦截器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-请求拦截器"}},[t._v("#")]),t._v(" 1. 请求拦截器:")]),t._v(" "),s("p",[t._v("在真正发送请求前执行的回调函数\n可以对请求进行检查或配置进行特定处理\n成功的回调函数, 传递的默认是config(也必须是)\n失败的回调函数, 传递的默认是error")]),t._v(" "),s("h4",{attrs:{id:"_2-响应拦截器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-响应拦截器"}},[t._v("#")]),t._v(" 2. 响应拦截器")]),t._v(" "),s("p",[t._v("在请求得到响应后执行的回调函数\n可以对响应数据进行特定处理\n成功的回调函数, 传递的默认是response\n失败的回调函数, 传递的默认是error")]),t._v(" "),s("h3",{attrs:{id:"_2-5-axios-的请求-响应数据转换器是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-axios-的请求-响应数据转换器是什么"}},[t._v("#")]),t._v(" 2.5 axios 的请求/响应数据转换器是什么?")]),t._v(" "),s("h4",{attrs:{id:"_1-请求转换器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-请求转换器"}},[t._v("#")]),t._v(" 1. 请求转换器")]),t._v(" "),s("p",[t._v("对请求头和请求体数据进行特定处理的函数")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setContentTypeIfUnset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json;charset=utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_2-响应转换器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-响应转换器"}},[t._v("#")]),t._v(" 2. 响应转换器")]),t._v(" "),s("p",[t._v("将响应体json 字符串解析为js 对象或数组的函数")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-6-response-的整体结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-response-的整体结构"}},[t._v("#")]),t._v(" 2.6 response 的整体结构")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tstatus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tstatusText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\theaders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tconfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\trequest\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-7-error-的整体结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-error-的整体结构"}},[t._v("#")]),t._v(" 2.7 error 的整体结构")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tmessage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tresponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\trequest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-8-如何取消未完成的请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-如何取消未完成的请求"}},[t._v("#")]),t._v(" 2.8 如何取消未完成的请求?")]),t._v(" "),s("h4",{attrs:{id:"_1-当配置了canceltoken-对象时-保存cancel-函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-当配置了canceltoken-对象时-保存cancel-函数"}},[t._v("#")]),t._v(" 1. 当配置了cancelToken 对象时, 保存cancel 函数")]),t._v(" "),s("p",[t._v("(1) 创建一个用于将来中断请求的cancelPromise\n(2) 并定义了一个用于取消请求的cancel 函数\n(3) 将cancel 函数传递出来")]),t._v(" "),s("h4",{attrs:{id:"_2-调用cancel-取消请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-调用cancel-取消请求"}},[t._v("#")]),t._v(" 2. 调用cancel()取消请求")]),t._v(" "),s("p",[t._v("(1) 执行cacel 函数, 传入错误信息message\n(2) 内部会让cancelPromise 变为成功, 且成功的值为一个Cancel 对象\n(3) 在cancelPromise 的成功回调中中断请求, 并让发请求的proimse 失败,失败的reason 为Cacel 对象")])])}),[],!1,null,null,null);a.default=e.exports}}]);